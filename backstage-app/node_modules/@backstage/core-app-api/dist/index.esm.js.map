{"version":3,"file":"index.esm.js","sources":["../src/apis/system/ApiAggregator.ts","../src/apis/system/ApiProvider.tsx","../src/apis/system/ApiResolver.ts","../src/apis/system/ApiFactoryRegistry.ts","../src/lib/loginPopup.ts","../src/lib/AuthConnector/DefaultAuthConnector.ts","../src/lib/AuthConnector/DirectAuthConnector.ts","../src/lib/AuthSessionManager/common.ts","../src/lib/subjects.ts","../src/lib/AuthSessionManager/SessionStateTracker.ts","../src/lib/AuthSessionManager/RefreshingAuthSessionManager.ts","../src/lib/AuthSessionManager/StaticAuthSessionManager.ts","../src/lib/AuthSessionManager/AuthSessionStore.ts","../src/apis/implementations/auth/oauth2/OAuth2.ts","../src/apis/implementations/auth/github/GithubAuth.ts","../src/apis/implementations/auth/gitlab/GitlabAuth.ts","../src/apis/implementations/auth/google/GoogleAuth.ts","../src/apis/implementations/auth/okta/OktaAuth.ts","../src/apis/implementations/auth/saml/types.ts","../src/apis/implementations/auth/saml/SamlAuth.ts","../src/apis/implementations/auth/microsoft/MicrosoftAuth.ts","../src/apis/implementations/auth/onelogin/OneLoginAuth.ts","../src/apis/implementations/auth/bitbucket/BitbucketAuth.ts","../src/apis/implementations/auth/atlassian/AtlassianAuth.ts","../src/apis/implementations/AlertApi/AlertApiForwarder.ts","../src/apis/implementations/AnalyticsApi/NoOpAnalyticsApi.ts","../src/apis/implementations/AppThemeApi/AppThemeSelector.ts","../src/apis/implementations/DiscoveryApi/UrlPatternDiscovery.ts","../src/apis/implementations/ErrorApi/ErrorAlerter.ts","../src/apis/implementations/ErrorApi/ErrorApiForwarder.ts","../src/apis/implementations/ErrorApi/UnhandledErrorForwarder.ts","../src/apis/implementations/FeatureFlagsApi/LocalStorageFeatureFlags.tsx","../src/apis/implementations/FetchApi/createFetchApi.ts","../src/apis/implementations/FetchApi/IdentityAuthInjectorFetchMiddleware.ts","../src/apis/implementations/FetchApi/PluginProtocolResolverFetchMiddleware.ts","../src/apis/implementations/FetchApi/FetchMiddlewares.ts","../src/apis/implementations/OAuthRequestApi/OAuthPendingRequests.ts","../src/apis/implementations/OAuthRequestApi/OAuthRequestManager.ts","../src/apis/implementations/StorageApi/WebStorage.ts","../src/extensions/traversal.ts","../src/plugins/collectors.ts","../src/routing/FeatureFlagged.tsx","../src/routing/collectors.tsx","../src/routing/types.ts","../src/routing/RouteResolver.ts","../src/routing/RoutingProvider.tsx","../src/routing/RouteTracker.tsx","../src/routing/validation.ts","../src/app/AppContext.tsx","../src/apis/implementations/IdentityApi/AppIdentityProxy.ts","../src/app/AppThemeProvider.tsx","../src/app/defaultConfigLoader.ts","../src/apis/system/ApiRegistry.ts","../src/app/resolveRouteBindings.ts","../src/app/AppManager.tsx","../src/app/createSpecializedApp.tsx","../src/routing/FlatRoutes.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\n/**\n * An ApiHolder that queries multiple other holders from for\n * an Api implementation, returning the first one encountered..\n */\nexport class ApiAggregator implements ApiHolder {\n  private readonly holders: ApiHolder[];\n\n  constructor(...holders: ApiHolder[]) {\n    this.holders = holders;\n  }\n\n  get<T>(apiRef: ApiRef<T>): T | undefined {\n    for (const holder of this.holders) {\n      const api = holder.get(apiRef);\n      if (api) {\n        return api;\n      }\n    }\n    return undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useContext, ReactNode, PropsWithChildren } from 'react';\nimport PropTypes from 'prop-types';\nimport { ApiHolder } from '@backstage/core-plugin-api';\nimport { ApiAggregator } from './ApiAggregator';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\n\n/**\n * Prop types for the ApiProvider component.\n * @public\n */\nexport type ApiProviderProps = {\n  apis: ApiHolder;\n  children: ReactNode;\n};\n\nconst ApiContext = createVersionedContext<{ 1: ApiHolder }>('api-context');\n\n/**\n * Provides an {@link @backstage/core-plugin-api#ApiHolder} for consumption in\n * the React tree.\n *\n * @public\n */\nexport const ApiProvider = (props: PropsWithChildren<ApiProviderProps>) => {\n  const { apis, children } = props;\n  const parentHolder = useContext(ApiContext)?.atVersion(1);\n  const holder = parentHolder ? new ApiAggregator(apis, parentHolder) : apis;\n\n  return (\n    <ApiContext.Provider\n      value={createVersionedValueMap({ 1: holder })}\n      children={children}\n    />\n  );\n};\n\nApiProvider.propTypes = {\n  apis: PropTypes.shape({ get: PropTypes.func.isRequired }).isRequired,\n  children: PropTypes.node,\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ApiRef,\n  ApiHolder,\n  AnyApiRef,\n  TypesToApiRefs,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryHolder } from './types';\n\n/**\n * Handles the actual on-demand instantiation and memoization of APIs out of\n * an {@link ApiFactoryHolder}.\n *\n * @public\n */\nexport class ApiResolver implements ApiHolder {\n  /**\n   * Validate factories by making sure that each of the apis can be created\n   * without hitting any circular dependencies.\n   */\n  static validateFactories(\n    factories: ApiFactoryHolder,\n    apis: Iterable<AnyApiRef>,\n  ) {\n    for (const api of apis) {\n      const heap = [api];\n      const allDeps = new Set<AnyApiRef>();\n\n      while (heap.length) {\n        const apiRef = heap.shift()!;\n        const factory = factories.get(apiRef);\n        if (!factory) {\n          continue;\n        }\n\n        for (const dep of Object.values(factory.deps)) {\n          if (dep.id === api.id) {\n            throw new Error(`Circular dependency of api factory for ${api}`);\n          }\n          if (!allDeps.has(dep)) {\n            allDeps.add(dep);\n            heap.push(dep);\n          }\n        }\n      }\n    }\n  }\n\n  private readonly apis = new Map<string, unknown>();\n\n  constructor(private readonly factories: ApiFactoryHolder) {}\n\n  get<T>(ref: ApiRef<T>): T | undefined {\n    return this.load(ref);\n  }\n\n  private load<T>(ref: ApiRef<T>, loading: AnyApiRef[] = []): T | undefined {\n    const impl = this.apis.get(ref.id);\n    if (impl) {\n      return impl as T;\n    }\n\n    const factory = this.factories.get(ref);\n    if (!factory) {\n      return undefined;\n    }\n\n    if (loading.includes(factory.api)) {\n      throw new Error(`Circular dependency of api factory for ${factory.api}`);\n    }\n\n    const deps = this.loadDeps(ref, factory.deps, [...loading, factory.api]);\n    const api = factory.factory(deps);\n    this.apis.set(ref.id, api);\n    return api as T;\n  }\n\n  private loadDeps<T>(\n    dependent: ApiRef<unknown>,\n    apis: TypesToApiRefs<T>,\n    loading: AnyApiRef[],\n  ): T {\n    const impls = {} as T;\n\n    for (const key in apis) {\n      if (apis.hasOwnProperty(key)) {\n        const ref = apis[key];\n\n        const api = this.load(ref, loading);\n        if (!api) {\n          throw new Error(\n            `No API factory available for dependency ${ref} of dependent ${dependent}`,\n          );\n        }\n        impls[key] = api;\n      }\n    }\n\n    return impls;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiFactoryHolder } from './types';\nimport {\n  ApiRef,\n  ApiFactory,\n  AnyApiRef,\n  AnyApiFactory,\n} from '@backstage/core-plugin-api';\n\n/**\n * Scope type when registering API factories.\n * @public\n */\nexport type ApiFactoryScope =\n  | 'default' // Default factories registered by core and plugins\n  | 'app' // Factories registered in the app, overriding default ones\n  | 'static'; // APIs that can't be overridden, e.g. config\n\nenum ScopePriority {\n  default = 10,\n  app = 50,\n  static = 100,\n}\n\ntype FactoryTuple = {\n  priority: number;\n  factory: AnyApiFactory;\n};\n\n/**\n * ApiFactoryRegistry is an ApiFactoryHolder implementation that enables\n * registration of API Factories with different scope.\n *\n * Each scope has an assigned priority, where factories registered with\n * higher priority scopes override ones with lower priority.\n *\n * @public\n */\nexport class ApiFactoryRegistry implements ApiFactoryHolder {\n  private readonly factories = new Map<string, FactoryTuple>();\n\n  /**\n   * Register a new API factory. Returns true if the factory was added\n   * to the registry.\n   *\n   * A factory will not be added to the registry if there is already\n   * an existing factory with the same or higher priority.\n   */\n  register<Api, Impl extends Api, Deps extends { [name in string]: unknown }>(\n    scope: ApiFactoryScope,\n    factory: ApiFactory<Api, Impl, Deps>,\n  ) {\n    const priority = ScopePriority[scope];\n    const existing = this.factories.get(factory.api.id);\n    if (existing && existing.priority >= priority) {\n      return false;\n    }\n\n    this.factories.set(factory.api.id, { priority, factory });\n    return true;\n  }\n\n  get<T>(\n    api: ApiRef<T>,\n  ): ApiFactory<T, T, { [x: string]: unknown }> | undefined {\n    const tuple = this.factories.get(api.id);\n    if (!tuple) {\n      return undefined;\n    }\n    return tuple.factory as ApiFactory<T, T, { [x: string]: unknown }>;\n  }\n\n  getAllApis(): Set<AnyApiRef> {\n    const refs = new Set<AnyApiRef>();\n    for (const { factory } of this.factories.values()) {\n      refs.add(factory.api);\n    }\n    return refs;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Options used to open a login popup.\n */\nexport type LoginPopupOptions = {\n  /**\n   * The URL that the auth popup should point to\n   */\n  url: string;\n\n  /**\n   * The name of the popup, as in second argument to window.open\n   */\n  name: string;\n\n  /**\n   * The origin of the final popup page that will post a message to this window.\n   */\n  origin: string;\n\n  /**\n   * The width of the popup in pixels, defaults to 500\n   */\n  width?: number;\n\n  /**\n   * The height of the popup in pixels, defaults to 700\n   */\n  height?: number;\n};\n\ntype AuthResult =\n  | {\n      type: 'authorization_response';\n      response: unknown;\n    }\n  | {\n      type: 'authorization_response';\n      error: {\n        name: string;\n        message: string;\n      };\n    };\n\n/**\n * Show a popup pointing to a URL that starts an auth flow. Implementing the receiving\n * end of the postMessage mechanism outlined in https://tools.ietf.org/html/draft-sakimura-oauth-wmrm-00\n *\n * The redirect handler of the flow should use postMessage to communicate back\n * to the app window. The message posted to the app must match the AuthResult type.\n *\n * The returned promise resolves to the response of the message that was posted from the auth popup.\n */\nexport function showLoginPopup(options: LoginPopupOptions): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const width = options.width || 500;\n    const height = options.height || 700;\n    const left = window.screen.width / 2 - width / 2;\n    const top = window.screen.height / 2 - height / 2;\n\n    const popup = window.open(\n      options.url,\n      options.name,\n      `menubar=no,location=no,resizable=no,scrollbars=no,status=no,width=${width},height=${height},top=${top},left=${left}`,\n    );\n\n    let targetOrigin = '';\n\n    if (!popup || typeof popup.closed === 'undefined' || popup.closed) {\n      const error = new Error('Failed to open auth popup.');\n      error.name = 'PopupRejectedError';\n      reject(error);\n      return;\n    }\n\n    const messageListener = (event: MessageEvent) => {\n      if (event.source !== popup) {\n        return;\n      }\n      if (event.origin !== options.origin) {\n        return;\n      }\n      const { data } = event;\n\n      if (data.type === 'config_info') {\n        targetOrigin = data.targetOrigin;\n        return;\n      }\n\n      if (data.type !== 'authorization_response') {\n        return;\n      }\n      const authResult = data as AuthResult;\n\n      if ('error' in authResult) {\n        const error = new Error(authResult.error.message);\n        error.name = authResult.error.name;\n        // TODO: proper error type\n        // error.extra = authResult.error.extra;\n        reject(error);\n      } else {\n        resolve(authResult.response);\n      }\n      done();\n    };\n\n    const intervalId = setInterval(() => {\n      if (popup.closed) {\n        const errMessage = `Login failed, ${\n          targetOrigin && targetOrigin !== window.location.origin\n            ? `Incorrect app origin, expected ${targetOrigin}`\n            : 'popup was closed'\n        }`;\n        const error = new Error(errMessage);\n        error.name = 'PopupClosedError';\n        reject(error);\n        done();\n      }\n    }, 100);\n\n    function done() {\n      window.removeEventListener('message', messageListener);\n      clearInterval(intervalId);\n    }\n\n    window.addEventListener('message', messageListener);\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  OAuthRequester,\n  OAuthRequestApi,\n  AuthProviderInfo,\n  DiscoveryApi,\n} from '@backstage/core-plugin-api';\nimport { showLoginPopup } from '../loginPopup';\nimport { AuthConnector, CreateSessionOptions } from './types';\n\ntype Options<AuthSession> = {\n  /**\n   * DiscoveryApi instance used to locate the auth backend endpoint.\n   */\n  discoveryApi: DiscoveryApi;\n  /**\n   * Environment hint passed on to auth backend, for example 'production' or 'development'\n   */\n  environment: string;\n  /**\n   * Information about the auth provider to be shown to the user.\n   * The ID Must match the backend auth plugin configuration, for example 'google'.\n   */\n  provider: AuthProviderInfo;\n  /**\n   * API used to instantiate an auth requester.\n   */\n  oauthRequestApi: OAuthRequestApi;\n  /**\n   * Function used to join together a set of scopes, defaults to joining with a space character.\n   */\n  joinScopes?: (scopes: Set<string>) => string;\n  /**\n   * Function used to transform an auth response into the session type.\n   */\n  sessionTransform?(response: any): AuthSession | Promise<AuthSession>;\n};\n\nfunction defaultJoinScopes(scopes: Set<string>) {\n  return [...scopes].join(' ');\n}\n\n/**\n * DefaultAuthConnector is the default auth connector in Backstage. It talks to the\n * backend auth plugin through the standardized API, and requests user permission\n * via the OAuthRequestApi.\n */\nexport class DefaultAuthConnector<AuthSession>\n  implements AuthConnector<AuthSession>\n{\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly environment: string;\n  private readonly provider: AuthProviderInfo;\n  private readonly joinScopesFunc: (scopes: Set<string>) => string;\n  private readonly authRequester: OAuthRequester<AuthSession>;\n  private readonly sessionTransform: (response: any) => Promise<AuthSession>;\n\n  constructor(options: Options<AuthSession>) {\n    const {\n      discoveryApi,\n      environment,\n      provider,\n      joinScopes = defaultJoinScopes,\n      oauthRequestApi,\n      sessionTransform = id => id,\n    } = options;\n\n    this.authRequester = oauthRequestApi.createAuthRequester({\n      provider,\n      onAuthRequest: scopes => this.showPopup(scopes),\n    });\n\n    this.discoveryApi = discoveryApi;\n    this.environment = environment;\n    this.provider = provider;\n    this.joinScopesFunc = joinScopes;\n    this.sessionTransform = sessionTransform;\n  }\n\n  async createSession(options: CreateSessionOptions): Promise<AuthSession> {\n    if (options.instantPopup) {\n      return this.showPopup(options.scopes);\n    }\n    return this.authRequester(options.scopes);\n  }\n\n  async refreshSession(): Promise<any> {\n    const res = await fetch(\n      await this.buildUrl('/refresh', { optional: true }),\n      {\n        headers: {\n          'x-requested-with': 'XMLHttpRequest',\n        },\n        credentials: 'include',\n      },\n    ).catch(error => {\n      throw new Error(`Auth refresh request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(\n        `Auth refresh request failed, ${res.statusText}`,\n      );\n      error.status = res.status;\n      throw error;\n    }\n\n    const authInfo = await res.json();\n\n    if (authInfo.error) {\n      const error = new Error(authInfo.error.message);\n      if (authInfo.error.name) {\n        error.name = authInfo.error.name;\n      }\n      throw error;\n    }\n    return await this.sessionTransform(authInfo);\n  }\n\n  async removeSession(): Promise<void> {\n    const res = await fetch(await this.buildUrl('/logout'), {\n      method: 'POST',\n      headers: {\n        'x-requested-with': 'XMLHttpRequest',\n      },\n      credentials: 'include',\n    }).catch(error => {\n      throw new Error(`Logout request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(`Logout request failed, ${res.statusText}`);\n      error.status = res.status;\n      throw error;\n    }\n  }\n\n  private async showPopup(scopes: Set<string>): Promise<AuthSession> {\n    const scope = this.joinScopesFunc(scopes);\n    const popupUrl = await this.buildUrl('/start', {\n      scope,\n      origin: location.origin,\n    });\n\n    const payload = await showLoginPopup({\n      url: popupUrl,\n      name: `${this.provider.title} Login`,\n      origin: new URL(popupUrl).origin,\n      width: 450,\n      height: 730,\n    });\n\n    return await this.sessionTransform(payload);\n  }\n\n  private async buildUrl(\n    path: string,\n    query?: { [key: string]: string | boolean | undefined },\n  ): Promise<string> {\n    const baseUrl = await this.discoveryApi.getBaseUrl('auth');\n    const queryString = this.buildQueryString({\n      ...query,\n      env: this.environment,\n    });\n\n    return `${baseUrl}/${this.provider.id}${path}${queryString}`;\n  }\n\n  private buildQueryString(query?: {\n    [key: string]: string | boolean | undefined;\n  }): string {\n    if (!query) {\n      return '';\n    }\n\n    const queryString = Object.entries<string | boolean | undefined>(query)\n      .map(([key, value]) => {\n        if (typeof value === 'string') {\n          return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n        } else if (value) {\n          return encodeURIComponent(key);\n        }\n        return undefined;\n      })\n      .filter(Boolean)\n      .join('&');\n\n    if (!queryString) {\n      return '';\n    }\n    return `?${queryString}`;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AuthProviderInfo, DiscoveryApi } from '@backstage/core-plugin-api';\nimport { showLoginPopup } from '../loginPopup';\n\ntype Options = {\n  discoveryApi: DiscoveryApi;\n  environment?: string;\n  provider: AuthProviderInfo;\n};\nexport class DirectAuthConnector<DirectAuthResponse> {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly environment: string | undefined;\n  private readonly provider: AuthProviderInfo;\n\n  constructor(options: Options) {\n    const { discoveryApi, environment, provider } = options;\n\n    this.discoveryApi = discoveryApi;\n    this.environment = environment;\n    this.provider = provider;\n  }\n\n  async createSession(): Promise<DirectAuthResponse> {\n    const popupUrl = await this.buildUrl('/start');\n    const payload = await showLoginPopup({\n      url: popupUrl,\n      name: `${this.provider.title} Login`,\n      origin: new URL(popupUrl).origin,\n      width: 450,\n      height: 730,\n    });\n\n    return {\n      ...payload,\n      id: payload.profile.email,\n    };\n  }\n\n  async refreshSession(): Promise<any> {}\n\n  async removeSession(): Promise<void> {\n    const res = await fetch(await this.buildUrl('/logout'), {\n      method: 'POST',\n      headers: {\n        'x-requested-with': 'XMLHttpRequest',\n      },\n      credentials: 'include',\n    }).catch(error => {\n      throw new Error(`Logout request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(`Logout request failed, ${res.statusText}`);\n      error.status = res.status;\n      throw error;\n    }\n  }\n\n  private async buildUrl(path: string): Promise<string> {\n    const baseUrl = await this.discoveryApi.getBaseUrl('auth');\n    return `${baseUrl}/${this.provider.id}${path}?env=${this.environment}`;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SessionScopesFunc } from './types';\n\nexport function hasScopes(\n  searched: Set<string>,\n  searchFor: Set<string>,\n): boolean {\n  for (const scope of searchFor) {\n    if (!searched.has(scope)) {\n      return false;\n    }\n  }\n  return true;\n}\n\ntype ScopeHelperOptions<T> = {\n  sessionScopes: SessionScopesFunc<T> | undefined;\n  defaultScopes?: Set<string>;\n};\n\nexport class SessionScopeHelper<T> {\n  constructor(private readonly options: ScopeHelperOptions<T>) {}\n\n  sessionExistsAndHasScope(\n    session: T | undefined,\n    scopes?: Set<string>,\n  ): boolean {\n    if (!session) {\n      return false;\n    }\n    if (!scopes) {\n      return true;\n    }\n    if (this.options.sessionScopes === undefined) {\n      return true;\n    }\n    const sessionScopes = this.options.sessionScopes(session);\n    return hasScopes(sessionScopes, scopes);\n  }\n\n  getExtendedScope(session: T | undefined, scopes?: Set<string>) {\n    const newScope = new Set(this.options.defaultScopes);\n    if (session && this.options.sessionScopes !== undefined) {\n      const sessionScopes = this.options.sessionScopes(session);\n      for (const scope of sessionScopes) {\n        newScope.add(scope);\n      }\n    }\n    if (scopes) {\n      for (const scope of scopes) {\n        newScope.add(scope);\n      }\n    }\n    return newScope;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\n\n// TODO(Rugvip): These are stopgap and probably incomplete implementations of subjects.\n// If we add a more complete Observables library they should be replaced.\n\n/**\n * A basic implementation of ReactiveX publish subjects.\n *\n * A subject is a convenient way to create an observable when you want\n * to fan out a single value to all subscribers.\n *\n * See http://reactivex.io/documentation/subject.html\n */\nexport class PublishSubject<T>\n  implements Observable<T>, ZenObservable.SubscriptionObserver<T>\n{\n  private isClosed = false;\n  private terminatingError?: Error;\n\n  private readonly observable = new ObservableImpl<T>(subscriber => {\n    if (this.isClosed) {\n      if (this.terminatingError) {\n        subscriber.error(this.terminatingError);\n      } else {\n        subscriber.complete();\n      }\n      return () => {};\n    }\n\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<T>\n  >();\n\n  [Symbol.observable]() {\n    return this;\n  }\n\n  get closed() {\n    return this.isClosed;\n  }\n\n  next(value: T) {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.subscribers.forEach(subscriber => subscriber.next(value));\n  }\n\n  error(error: Error) {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.isClosed = true;\n    this.terminatingError = error;\n    this.subscribers.forEach(subscriber => subscriber.error(error));\n  }\n\n  complete() {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.isClosed = true;\n    this.subscribers.forEach(subscriber => subscriber.complete());\n  }\n\n  subscribe(observer: ZenObservable.Observer<T>): ZenObservable.Subscription;\n  subscribe(\n    onNext: (value: T) => void,\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription;\n  subscribe(\n    onNext: ZenObservable.Observer<T> | ((value: T) => void),\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription {\n    const observer =\n      typeof onNext === 'function'\n        ? {\n            next: onNext,\n            error: onError,\n            complete: onComplete,\n          }\n        : onNext;\n\n    return this.observable.subscribe(observer);\n  }\n}\n\n/**\n * A basic implementation of ReactiveX behavior subjects.\n *\n * A subject is a convenient way to create an observable when you want\n * to fan out a single value to all subscribers.\n *\n * The BehaviorSubject will emit the most recently emitted value or error\n * whenever a new observer subscribes to the subject.\n *\n * See http://reactivex.io/documentation/subject.html\n */\n\nexport class BehaviorSubject<T>\n  implements Observable<T>, ZenObservable.SubscriptionObserver<T>\n{\n  private isClosed: boolean;\n  private currentValue: T;\n  private terminatingError: Error | undefined;\n  private readonly observable: Observable<T>;\n\n  constructor(value: T) {\n    this.isClosed = false;\n    this.currentValue = value;\n    this.terminatingError = undefined;\n    this.observable = new ObservableImpl<T>(subscriber => {\n      if (this.isClosed) {\n        if (this.terminatingError) {\n          subscriber.error(this.terminatingError);\n        } else {\n          subscriber.complete();\n        }\n        return () => {};\n      }\n\n      subscriber.next(this.currentValue);\n\n      this.subscribers.add(subscriber);\n      return () => {\n        this.subscribers.delete(subscriber);\n      };\n    });\n  }\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<T>\n  >();\n\n  [Symbol.observable]() {\n    return this;\n  }\n\n  get closed() {\n    return this.isClosed;\n  }\n\n  next(value: T) {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.currentValue = value;\n    this.subscribers.forEach(subscriber => subscriber.next(value));\n  }\n\n  error(error: Error) {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.isClosed = true;\n    this.terminatingError = error;\n    this.subscribers.forEach(subscriber => subscriber.error(error));\n  }\n\n  complete() {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.isClosed = true;\n    this.subscribers.forEach(subscriber => subscriber.complete());\n  }\n\n  subscribe(observer: ZenObservable.Observer<T>): ZenObservable.Subscription;\n  subscribe(\n    onNext: (value: T) => void,\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription;\n  subscribe(\n    onNext: ZenObservable.Observer<T> | ((value: T) => void),\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription {\n    const observer =\n      typeof onNext === 'function'\n        ? {\n            next: onNext,\n            error: onError,\n            complete: onComplete,\n          }\n        : onNext;\n\n    return this.observable.subscribe(observer);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BehaviorSubject } from '../subjects';\nimport { SessionState } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\n\nexport class SessionStateTracker {\n  private readonly subject = new BehaviorSubject<SessionState>(\n    SessionState.SignedOut,\n  );\n\n  private signedIn: boolean = false;\n\n  setIsSignedIn(isSignedIn: boolean) {\n    if (this.signedIn !== isSignedIn) {\n      this.signedIn = isSignedIn;\n      this.subject.next(\n        this.signedIn ? SessionState.SignedIn : SessionState.SignedOut,\n      );\n    }\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  SessionManager,\n  SessionScopesFunc,\n  SessionShouldRefreshFunc,\n  GetSessionOptions,\n} from './types';\nimport { AuthConnector } from '../AuthConnector';\nimport { SessionScopeHelper, hasScopes } from './common';\nimport { SessionStateTracker } from './SessionStateTracker';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  connector: AuthConnector<T>;\n  /** Used to get the scope of the session */\n  sessionScopes: SessionScopesFunc<T>;\n  /** Used to check if the session needs to be refreshed */\n  sessionShouldRefresh: SessionShouldRefreshFunc<T>;\n  /** The default scopes that should always be present in a session, defaults to none. */\n  defaultScopes?: Set<string>;\n};\n\n/**\n * RefreshingAuthSessionManager manages an underlying session that has\n * and expiration time and needs to be refreshed periodically.\n */\nexport class RefreshingAuthSessionManager<T> implements SessionManager<T> {\n  private readonly connector: AuthConnector<T>;\n  private readonly helper: SessionScopeHelper<T>;\n  private readonly sessionScopesFunc: SessionScopesFunc<T>;\n  private readonly sessionShouldRefreshFunc: SessionShouldRefreshFunc<T>;\n  private readonly stateTracker = new SessionStateTracker();\n\n  private refreshPromise?: Promise<T>;\n  private currentSession: T | undefined;\n\n  constructor(options: Options<T>) {\n    const {\n      connector,\n      defaultScopes = new Set(),\n      sessionScopes,\n      sessionShouldRefresh,\n    } = options;\n\n    this.connector = connector;\n    this.sessionScopesFunc = sessionScopes;\n    this.sessionShouldRefreshFunc = sessionShouldRefresh;\n    this.helper = new SessionScopeHelper({ sessionScopes, defaultScopes });\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    if (\n      this.helper.sessionExistsAndHasScope(this.currentSession, options.scopes)\n    ) {\n      const shouldRefresh = this.sessionShouldRefreshFunc(this.currentSession!);\n      if (!shouldRefresh) {\n        return this.currentSession!;\n      }\n\n      try {\n        const refreshedSession = await this.collapsedSessionRefresh();\n        const currentScopes = this.sessionScopesFunc(this.currentSession!);\n        const refreshedScopes = this.sessionScopesFunc(refreshedSession);\n        if (hasScopes(refreshedScopes, currentScopes)) {\n          this.currentSession = refreshedSession;\n        }\n        return refreshedSession;\n      } catch (error) {\n        if (options.optional) {\n          return undefined;\n        }\n        throw error;\n      }\n    }\n\n    // The user may still have a valid refresh token in their cookies. Attempt to\n    // initiate a fresh session through the backend using that refresh token.\n    //\n    // We skip this check if an instant login popup is requested, as we need to\n    // stay in a synchronous call stack from the user interaction. The downside\n    // is that that the user will sometimes be requested to log in even if they\n    // already had an existing session.\n    if (!this.currentSession && !options.instantPopup) {\n      try {\n        const newSession = await this.collapsedSessionRefresh();\n        this.currentSession = newSession;\n        // The session might not have the scopes requested so go back and check again\n        return this.getSession(options);\n      } catch {\n        // If the refresh attempt fails we assume we don't have a session, so continue to create one.\n      }\n    }\n\n    // If we continue here we will show a popup, so exit if this is an optional session request.\n    if (options.optional) {\n      return undefined;\n    }\n\n    // We can call authRequester multiple times, the returned session will contain all requested scopes.\n    this.currentSession = await this.connector.createSession({\n      ...options,\n      scopes: this.helper.getExtendedScope(this.currentSession, options.scopes),\n    });\n    this.stateTracker.setIsSignedIn(true);\n    return this.currentSession;\n  }\n\n  async removeSession() {\n    this.currentSession = undefined;\n    await this.connector.removeSession();\n    this.stateTracker.setIsSignedIn(false);\n  }\n\n  sessionState$() {\n    return this.stateTracker.sessionState$();\n  }\n\n  private async collapsedSessionRefresh(): Promise<T> {\n    if (this.refreshPromise) {\n      return this.refreshPromise;\n    }\n\n    this.refreshPromise = this.connector.refreshSession();\n\n    try {\n      const session = await this.refreshPromise;\n      this.stateTracker.setIsSignedIn(true);\n      return session;\n    } finally {\n      delete this.refreshPromise;\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MutableSessionManager, GetSessionOptions } from './types';\nimport { AuthConnector } from '../AuthConnector';\nimport { SessionScopeHelper } from './common';\nimport { SessionStateTracker } from './SessionStateTracker';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  connector: AuthConnector<T>;\n  /** Used to get the scope of the session */\n  sessionScopes?: (session: T) => Set<string>;\n  /** The default scopes that should always be present in a session, defaults to none. */\n  defaultScopes?: Set<string>;\n};\n\n/**\n * StaticAuthSessionManager manages an underlying session that does not expire.\n */\nexport class StaticAuthSessionManager<T> implements MutableSessionManager<T> {\n  private readonly connector: AuthConnector<T>;\n  private readonly helper: SessionScopeHelper<T>;\n  private readonly stateTracker = new SessionStateTracker();\n\n  private currentSession: T | undefined;\n\n  constructor(options: Options<T>) {\n    const { connector, defaultScopes = new Set(), sessionScopes } = options;\n\n    this.connector = connector;\n    this.helper = new SessionScopeHelper({ sessionScopes, defaultScopes });\n  }\n\n  setSession(session: T | undefined): void {\n    this.currentSession = session;\n    this.stateTracker.setIsSignedIn(Boolean(session));\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    if (\n      this.helper.sessionExistsAndHasScope(this.currentSession, options.scopes)\n    ) {\n      return this.currentSession;\n    }\n\n    // If we continue here we will show a popup, so exit if this is an optional session request.\n    if (options.optional) {\n      return undefined;\n    }\n\n    // We can call authRequester multiple times, the returned session will contain all requested scopes.\n    this.currentSession = await this.connector.createSession({\n      ...options,\n      scopes: this.helper.getExtendedScope(this.currentSession, options.scopes),\n    });\n    this.stateTracker.setIsSignedIn(true);\n    return this.currentSession;\n  }\n\n  /**\n   * We don't call this.connector.removeSession here, since this session manager\n   * is intended to be static. As such there's no need to hit the remote logout\n   * endpoint - simply discarding the local session state when signing out is\n   * enough.\n   */\n  async removeSession() {\n    this.currentSession = undefined;\n    this.stateTracker.setIsSignedIn(false);\n  }\n\n  sessionState$() {\n    return this.stateTracker.sessionState$();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ZodSchema } from 'zod';\nimport {\n  MutableSessionManager,\n  SessionScopesFunc,\n  SessionShouldRefreshFunc,\n  GetSessionOptions,\n} from './types';\nimport { SessionScopeHelper } from './common';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  manager: MutableSessionManager<T>;\n  /** Storage key to use to store sessions */\n  storageKey: string;\n  /** The schema used to validate the stored data */\n  schema: ZodSchema<T>;\n  /** Used to get the scope of the session */\n  sessionScopes?: SessionScopesFunc<T>;\n  /** Used to check if the session needs to be refreshed, defaults to never refresh */\n  sessionShouldRefresh?: SessionShouldRefreshFunc<T>;\n};\n\n/**\n * AuthSessionStore decorates another SessionManager with a functionality\n * to store the session in local storage.\n *\n * Session is serialized to JSON with special support for following types: Set.\n */\nexport class AuthSessionStore<T> implements MutableSessionManager<T> {\n  private readonly manager: MutableSessionManager<T>;\n  private readonly storageKey: string;\n  private readonly schema: ZodSchema<T>;\n  private readonly sessionShouldRefreshFunc: SessionShouldRefreshFunc<T>;\n  private readonly helper: SessionScopeHelper<T>;\n\n  constructor(options: Options<T>) {\n    const {\n      manager,\n      storageKey,\n      schema,\n      sessionScopes,\n      sessionShouldRefresh = () => false,\n    } = options;\n\n    this.manager = manager;\n    this.storageKey = storageKey;\n    this.schema = schema;\n    this.sessionShouldRefreshFunc = sessionShouldRefresh;\n    this.helper = new SessionScopeHelper({\n      sessionScopes,\n      defaultScopes: new Set(),\n    });\n  }\n\n  setSession(session: T | undefined): void {\n    this.manager.setSession(session);\n    this.saveSession(session);\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    const { scopes } = options;\n    const session = this.loadSession();\n\n    if (this.helper.sessionExistsAndHasScope(session, scopes)) {\n      const shouldRefresh = this.sessionShouldRefreshFunc(session!);\n\n      if (!shouldRefresh) {\n        this.manager.setSession(session!);\n        return session!;\n      }\n    }\n\n    const newSession = await this.manager.getSession(options);\n    this.saveSession(newSession);\n    return newSession;\n  }\n\n  async removeSession() {\n    localStorage.removeItem(this.storageKey);\n    await this.manager.removeSession();\n  }\n\n  sessionState$() {\n    return this.manager.sessionState$();\n  }\n\n  private loadSession(): T | undefined {\n    try {\n      const sessionJson = localStorage.getItem(this.storageKey);\n      if (sessionJson) {\n        const session = JSON.parse(sessionJson, (_key, value) => {\n          if (value?.__type === 'Set') {\n            return new Set(value.__value);\n          }\n          return value;\n        });\n\n        try {\n          return this.schema.parse(session);\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.log(\n            `Failed to load session from local storage because it did not conform to the expected schema, ${e}`,\n          );\n          throw e;\n        }\n      }\n\n      return undefined;\n    } catch (error) {\n      localStorage.removeItem(this.storageKey);\n      return undefined;\n    }\n  }\n\n  private saveSession(session: T | undefined) {\n    if (session === undefined) {\n      localStorage.removeItem(this.storageKey);\n      return;\n    }\n\n    try {\n      this.schema.parse(session);\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `Failed to save session to local storage because it did not conform to the expected schema, ${e}`,\n      );\n      return;\n    }\n\n    localStorage.setItem(\n      this.storageKey,\n      JSON.stringify(session, (_key, value) => {\n        if (value instanceof Set) {\n          return {\n            __type: 'Set',\n            __value: Array.from(value),\n          };\n        }\n        return value;\n      }),\n    );\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DefaultAuthConnector } from '../../../../lib/AuthConnector';\nimport { RefreshingAuthSessionManager } from '../../../../lib/AuthSessionManager';\nimport { SessionManager } from '../../../../lib/AuthSessionManager/types';\nimport {\n  AuthRequestOptions,\n  BackstageIdentityResponse,\n  OAuthApi,\n  OpenIdConnectApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  SessionState,\n  SessionApi,\n  BackstageIdentityApi,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { OAuth2Session } from './types';\nimport { OAuthApiCreateOptions } from '../types';\n\n/**\n * OAuth2 create options.\n * @public\n */\nexport type OAuth2CreateOptions = OAuthApiCreateOptions & {\n  scopeTransform?: (scopes: string[]) => string[];\n};\n\nexport type OAuth2Response = {\n  providerInfo: {\n    accessToken: string;\n    idToken: string;\n    scope: string;\n    expiresInSeconds: number;\n  };\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'oauth2',\n  title: 'Your Identity Provider',\n  icon: () => null,\n};\n\n/**\n * Implements a generic OAuth2 flow for auth.\n *\n * @public\n */\nexport default class OAuth2\n  implements\n    OAuthApi,\n    OpenIdConnectApi,\n    ProfileInfoApi,\n    BackstageIdentityApi,\n    SessionApi\n{\n  static create(options: OAuth2CreateOptions) {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = [],\n      scopeTransform = x => x,\n    } = options;\n\n    const connector = new DefaultAuthConnector({\n      discoveryApi,\n      environment,\n      provider,\n      oauthRequestApi: oauthRequestApi,\n      sessionTransform(res: OAuth2Response): OAuth2Session {\n        return {\n          ...res,\n          providerInfo: {\n            idToken: res.providerInfo.idToken,\n            accessToken: res.providerInfo.accessToken,\n            scopes: OAuth2.normalizeScopes(\n              scopeTransform,\n              res.providerInfo.scope,\n            ),\n            expiresAt: new Date(\n              Date.now() + res.providerInfo.expiresInSeconds * 1000,\n            ),\n          },\n        };\n      },\n    });\n\n    const sessionManager = new RefreshingAuthSessionManager({\n      connector,\n      defaultScopes: new Set(defaultScopes),\n      sessionScopes: (session: OAuth2Session) => session.providerInfo.scopes,\n      sessionShouldRefresh: (session: OAuth2Session) => {\n        const expiresInSec =\n          (session.providerInfo.expiresAt.getTime() - Date.now()) / 1000;\n        return expiresInSec < 60 * 5;\n      },\n    });\n\n    return new OAuth2({ sessionManager, scopeTransform });\n  }\n\n  private readonly sessionManager: SessionManager<OAuth2Session>;\n  private readonly scopeTransform: (scopes: string[]) => string[];\n\n  private constructor(options: {\n    sessionManager: SessionManager<OAuth2Session>;\n    scopeTransform: (scopes: string[]) => string[];\n  }) {\n    this.sessionManager = options.sessionManager;\n    this.scopeTransform = options.scopeTransform;\n  }\n\n  async signIn() {\n    await this.getAccessToken();\n  }\n\n  async signOut() {\n    await this.sessionManager.removeSession();\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.sessionManager.sessionState$();\n  }\n\n  async getAccessToken(\n    scope?: string | string[],\n    options?: AuthRequestOptions,\n  ) {\n    const normalizedScopes = OAuth2.normalizeScopes(this.scopeTransform, scope);\n    const session = await this.sessionManager.getSession({\n      ...options,\n      scopes: normalizedScopes,\n    });\n    return session?.providerInfo.accessToken ?? '';\n  }\n\n  async getIdToken(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.providerInfo.idToken ?? '';\n  }\n\n  async getBackstageIdentity(\n    options: AuthRequestOptions = {},\n  ): Promise<BackstageIdentityResponse | undefined> {\n    const session = await this.sessionManager.getSession(options);\n    return session?.backstageIdentity;\n  }\n\n  async getProfile(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.profile;\n  }\n\n  private static normalizeScopes(\n    scopeTransform: (scopes: string[]) => string[],\n    scopes?: string | string[],\n  ): Set<string> {\n    if (!scopes) {\n      return new Set();\n    }\n\n    const scopeList = Array.isArray(scopes)\n      ? scopes\n      : scopes.split(/[\\s|,]/).filter(Boolean);\n\n    return new Set(scopeTransform(scopeList));\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { githubAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'github',\n  title: 'GitHub',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to GitHub products.\n *\n * @public\n */\nexport default class GithubAuth {\n  static create(options: OAuthApiCreateOptions): typeof githubAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['read:user'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { gitlabAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'gitlab',\n  title: 'GitLab',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to GitLab products.\n *\n * @public\n */\nexport default class GitlabAuth {\n  static create(options: OAuthApiCreateOptions): typeof gitlabAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['read_user'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { googleAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'google',\n  title: 'Google',\n  icon: () => null,\n};\n\nconst SCOPE_PREFIX = 'https://www.googleapis.com/auth/';\n\n/**\n * Implements the OAuth flow to Google products.\n *\n * @public\n */\nexport default class GoogleAuth {\n  static create(options: OAuthApiCreateOptions): typeof googleAuthApiRef.T {\n    const {\n      discoveryApi,\n      oauthRequestApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      defaultScopes = [\n        'openid',\n        `${SCOPE_PREFIX}userinfo.email`,\n        `${SCOPE_PREFIX}userinfo.profile`,\n      ],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes: string[]) {\n        return scopes.map(scope => {\n          if (scope === 'openid') {\n            return scope;\n          }\n\n          if (scope === 'profile' || scope === 'email') {\n            return `${SCOPE_PREFIX}userinfo.${scope}`;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { oktaAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'okta',\n  title: 'Okta',\n  icon: () => null,\n};\n\nconst OKTA_OIDC_SCOPES: Set<String> = new Set([\n  'openid',\n  'profile',\n  'email',\n  'phone',\n  'address',\n  'groups',\n  'offline_access',\n]);\n\nconst OKTA_SCOPE_PREFIX: string = 'okta.';\n\n/**\n * Implements the OAuth flow to Okta products.\n *\n * @public\n */\nexport default class OktaAuth {\n  static create(options: OAuthApiCreateOptions): typeof oktaAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['openid', 'email', 'profile', 'offline_access'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes) {\n        return scopes.map(scope => {\n          if (OKTA_OIDC_SCOPES.has(scope)) {\n            return scope;\n          }\n\n          if (scope.startsWith(OKTA_SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${OKTA_SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\nimport { z } from 'zod';\n\n/** @internal */\nexport type SamlSession = {\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\n/** @internal */\nexport const samlSessionSchema: z.ZodSchema<SamlSession> = z.object({\n  profile: z.object({\n    email: z.string().optional(),\n    displayName: z.string().optional(),\n    picture: z.string().optional(),\n  }),\n  backstageIdentity: z.object({\n    id: z.string(),\n    token: z.string(),\n    identity: z.object({\n      type: z.literal('user'),\n      userEntityRef: z.string(),\n      ownershipEntityRefs: z.array(z.string()),\n    }),\n  }),\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AuthRequestOptions,\n  BackstageIdentityApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  SessionApi,\n  SessionState,\n  BackstageIdentityResponse,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { DirectAuthConnector } from '../../../../lib/AuthConnector';\nimport {\n  AuthSessionStore,\n  StaticAuthSessionManager,\n} from '../../../../lib/AuthSessionManager';\nimport { SessionManager } from '../../../../lib/AuthSessionManager/types';\nimport { AuthApiCreateOptions } from '../types';\nimport { SamlSession, samlSessionSchema } from './types';\n\nexport type SamlAuthResponse = {\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'saml',\n  title: 'SAML',\n  icon: () => null,\n};\n\n/**\n * Implements a general SAML based auth flow.\n *\n * @public\n */\nexport default class SamlAuth\n  implements ProfileInfoApi, BackstageIdentityApi, SessionApi\n{\n  static create(options: AuthApiCreateOptions) {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n    } = options;\n\n    const connector = new DirectAuthConnector<SamlSession>({\n      discoveryApi,\n      environment,\n      provider,\n    });\n\n    const sessionManager = new StaticAuthSessionManager<SamlSession>({\n      connector,\n    });\n\n    const authSessionStore = new AuthSessionStore<SamlSession>({\n      manager: sessionManager,\n      storageKey: `${provider.id}Session`,\n      schema: samlSessionSchema,\n    });\n\n    return new SamlAuth(authSessionStore);\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.sessionManager.sessionState$();\n  }\n\n  private constructor(\n    private readonly sessionManager: SessionManager<SamlSession>,\n  ) {}\n\n  async signIn() {\n    await this.getBackstageIdentity({});\n  }\n  async signOut() {\n    await this.sessionManager.removeSession();\n  }\n\n  async getBackstageIdentity(\n    options: AuthRequestOptions = {},\n  ): Promise<BackstageIdentityResponse | undefined> {\n    const session = await this.sessionManager.getSession(options);\n    return session?.backstageIdentity;\n  }\n\n  async getProfile(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.profile;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { microsoftAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'microsoft',\n  title: 'Microsoft',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Microsoft products.\n *\n * @public\n */\nexport default class MicrosoftAuth {\n  static create(options: OAuthApiCreateOptions): typeof microsoftAuthApiRef.T {\n    const {\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      discoveryApi,\n      defaultScopes = [\n        'openid',\n        'offline_access',\n        'profile',\n        'email',\n        'User.Read',\n      ],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  oneloginAuthApiRef,\n  OAuthRequestApi,\n  AuthProviderInfo,\n  DiscoveryApi,\n} from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\n\n/**\n * OneLogin auth provider create options.\n * @public\n */\nexport type OneLoginAuthCreateOptions = {\n  discoveryApi: DiscoveryApi;\n  oauthRequestApi: OAuthRequestApi;\n  environment?: string;\n  provider?: AuthProviderInfo;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'onelogin',\n  title: 'onelogin',\n  icon: () => null,\n};\n\nconst OIDC_SCOPES: Set<String> = new Set([\n  'openid',\n  'profile',\n  'email',\n  'phone',\n  'address',\n  'groups',\n  'offline_access',\n]);\n\nconst SCOPE_PREFIX: string = 'onelogin.';\n\n/**\n * Implements a OneLogin OAuth flow.\n *\n * @public\n */\nexport default class OneLoginAuth {\n  static create(\n    options: OneLoginAuthCreateOptions,\n  ): typeof oneloginAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes: ['openid', 'email', 'profile', 'offline_access'],\n      scopeTransform(scopes) {\n        return scopes.map(scope => {\n          if (OIDC_SCOPES.has(scope)) {\n            return scope;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  bitbucketAuthApiRef,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\n\nimport { OAuthApiCreateOptions } from '../types';\nimport { OAuth2 } from '../oauth2';\n\nexport type BitbucketAuthResponse = {\n  providerInfo: {\n    accessToken: string;\n    scope: string;\n    expiresInSeconds: number;\n  };\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'bitbucket',\n  title: 'Bitbucket',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Bitbucket products.\n *\n * @public\n */\nexport default class BitbucketAuth {\n  static create(options: OAuthApiCreateOptions): typeof bitbucketAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['team'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { atlassianAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'atlassian',\n  title: 'Atlassian',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Atlassian products.\n *\n * @public\n */\nexport default class AtlassianAuth {\n  static create(options: OAuthApiCreateOptions): typeof atlassianAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AlertApi, AlertMessage } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { PublishSubject } from '../../../lib/subjects';\n\n/**\n * Base implementation for the AlertApi that simply forwards alerts to consumers.\n *\n * @public\n */\nexport class AlertApiForwarder implements AlertApi {\n  private readonly subject = new PublishSubject<AlertMessage>();\n\n  post(alert: AlertMessage) {\n    this.subject.next(alert);\n  }\n\n  alert$(): Observable<AlertMessage> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AnalyticsApi, AnalyticsEvent } from '@backstage/core-plugin-api';\n\n/**\n * Base implementation for the AnalyticsApi that does nothing.\n *\n * @public\n */\nexport class NoOpAnalyticsApi implements AnalyticsApi {\n  captureEvent(_event: AnalyticsEvent): void {}\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppThemeApi, AppTheme } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\nconst STORAGE_KEY = 'theme';\n\n/**\n * Exposes the themes installed in the app, and permits switching the currently\n * active theme.\n *\n * @public\n */\nexport class AppThemeSelector implements AppThemeApi {\n  static createWithStorage(themes: AppTheme[]) {\n    const selector = new AppThemeSelector(themes);\n\n    if (!window.localStorage) {\n      return selector;\n    }\n\n    const initialThemeId =\n      window.localStorage.getItem(STORAGE_KEY) ?? undefined;\n\n    selector.setActiveThemeId(initialThemeId);\n\n    selector.activeThemeId$().subscribe(themeId => {\n      if (themeId) {\n        window.localStorage.setItem(STORAGE_KEY, themeId);\n      } else {\n        window.localStorage.removeItem(STORAGE_KEY);\n      }\n    });\n\n    window.addEventListener('storage', event => {\n      if (event.key === STORAGE_KEY) {\n        const themeId = localStorage.getItem(STORAGE_KEY) ?? undefined;\n        selector.setActiveThemeId(themeId);\n      }\n    });\n\n    return selector;\n  }\n\n  private activeThemeId: string | undefined;\n  private readonly subject = new BehaviorSubject<string | undefined>(undefined);\n\n  constructor(private readonly themes: AppTheme[]) {}\n\n  getInstalledThemes(): AppTheme[] {\n    return this.themes.slice();\n  }\n\n  activeThemeId$(): Observable<string | undefined> {\n    return this.subject;\n  }\n\n  getActiveThemeId(): string | undefined {\n    return this.activeThemeId;\n  }\n\n  setActiveThemeId(themeId?: string): void {\n    this.activeThemeId = themeId;\n    this.subject.next(themeId);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\n\nconst ERROR_PREFIX = 'Invalid discovery URL pattern,';\n\n/**\n * UrlPatternDiscovery is a lightweight DiscoveryApi implementation.\n * It uses a single template string to construct URLs for each plugin.\n *\n * @public\n */\nexport class UrlPatternDiscovery implements DiscoveryApi {\n  /**\n   * Creates a new UrlPatternDiscovery given a template. The the only\n   * interpolation done for the template is to replace instances of `{{pluginId}}`\n   * with the ID of the plugin being requested.\n   *\n   * Example pattern: `http://localhost:7007/api/{{ pluginId }}`\n   */\n  static compile(pattern: string): UrlPatternDiscovery {\n    const parts = pattern.split(/\\{\\{\\s*pluginId\\s*\\}\\}/);\n    const urlStr = parts.join('pluginId');\n\n    let url;\n    try {\n      url = new URL(urlStr);\n    } catch {\n      throw new Error(`${ERROR_PREFIX} URL '${urlStr}' is invalid`);\n    }\n    if (url.hash) {\n      throw new Error(`${ERROR_PREFIX} URL must not have a hash`);\n    }\n    if (url.search) {\n      throw new Error(`${ERROR_PREFIX} URL must not have a query`);\n    }\n    if (urlStr.endsWith('/')) {\n      throw new Error(`${ERROR_PREFIX} URL must not end with a slash`);\n    }\n\n    return new UrlPatternDiscovery(parts);\n  }\n\n  private constructor(private readonly parts: string[]) {}\n\n  async getBaseUrl(pluginId: string): Promise<string> {\n    return this.parts.join(pluginId);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n  AlertApi,\n} from '@backstage/core-plugin-api';\n\n/**\n * Decorates an ErrorApi by also forwarding error messages\n * to the alertApi with an 'error' severity.\n *\n * @public\n */\nexport class ErrorAlerter implements ErrorApi {\n  constructor(\n    private readonly alertApi: AlertApi,\n    private readonly errorApi: ErrorApi,\n  ) {}\n\n  post(error: ErrorApiError, context?: ErrorApiErrorContext) {\n    if (!context?.hidden) {\n      this.alertApi.post({ message: error.message, severity: 'error' });\n    }\n\n    return this.errorApi.post(error, context);\n  }\n\n  error$() {\n    return this.errorApi.error$();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { PublishSubject } from '../../../lib/subjects';\n\n/**\n * Base implementation for the ErrorApi that simply forwards errors to consumers.\n *\n * @public\n */\nexport class ErrorApiForwarder implements ErrorApi {\n  private readonly subject = new PublishSubject<{\n    error: Error;\n    context?: ErrorApiErrorContext;\n  }>();\n\n  post(error: ErrorApiError, context?: ErrorApiErrorContext) {\n    this.subject.next({ error, context });\n  }\n\n  error$(): Observable<{ error: Error; context?: ErrorApiErrorContext }> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n} from '@backstage/core-plugin-api';\n\n/**\n * Utility class that helps with error forwarding.\n *\n * @public\n */\nexport class UnhandledErrorForwarder {\n  /**\n   * Add event listener, such that unhandled errors can be forwarded using an given `ErrorApi` instance\n   */\n  static forward(errorApi: ErrorApi, errorContext: ErrorApiErrorContext) {\n    window.addEventListener(\n      'unhandledrejection',\n      (e: PromiseRejectionEvent) => {\n        errorApi.post(e.reason as ErrorApiError, errorContext);\n      },\n    );\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FeatureFlagState,\n  FeatureFlagsApi,\n  FeatureFlag,\n  FeatureFlagsSaveOptions,\n} from '@backstage/core-plugin-api';\n\nexport function validateFlagName(name: string): void {\n  if (name.length < 3) {\n    throw new Error(\n      `The '${name}' feature flag must have a minimum length of three characters.`,\n    );\n  }\n\n  if (name.length > 150) {\n    throw new Error(\n      `The '${name}' feature flag must not exceed 150 characters.`,\n    );\n  }\n\n  if (!name.match(/^[a-z]+[a-z0-9-]+$/)) {\n    throw new Error(\n      `The '${name}' feature flag must start with a lowercase letter and only contain lowercase letters, numbers and hyphens. ` +\n        'Examples: feature-flag-one, alpha, release-2020',\n    );\n  }\n}\n\n/**\n * A feature flags implementation that stores the flags in the browser's local\n * storage.\n *\n * @public\n */\nexport class LocalStorageFeatureFlags implements FeatureFlagsApi {\n  private registeredFeatureFlags: FeatureFlag[] = [];\n  private flags?: Map<string, FeatureFlagState>;\n\n  registerFlag(flag: FeatureFlag) {\n    validateFlagName(flag.name);\n    this.registeredFeatureFlags.push(flag);\n  }\n\n  getRegisteredFlags(): FeatureFlag[] {\n    return this.registeredFeatureFlags.slice();\n  }\n\n  isActive(name: string): boolean {\n    if (!this.flags) {\n      this.flags = this.load();\n    }\n    return this.flags.get(name) === FeatureFlagState.Active;\n  }\n\n  save(options: FeatureFlagsSaveOptions): void {\n    if (!this.flags) {\n      this.flags = this.load();\n    }\n    if (!options.merge) {\n      this.flags.clear();\n    }\n    for (const [name, state] of Object.entries(options.states)) {\n      this.flags.set(name, state);\n    }\n\n    const enabled = Array.from(this.flags.entries()).filter(\n      ([, state]) => state === FeatureFlagState.Active,\n    );\n    window.localStorage.setItem(\n      'featureFlags',\n      JSON.stringify(Object.fromEntries(enabled)),\n    );\n  }\n\n  private load(): Map<string, FeatureFlagState> {\n    try {\n      const jsonStr = window.localStorage.getItem('featureFlags');\n      if (!jsonStr) {\n        return new Map();\n      }\n      const json = JSON.parse(jsonStr) as unknown;\n      if (typeof json !== 'object' || json === null || Array.isArray(json)) {\n        return new Map();\n      }\n\n      const entries = Object.entries(json).filter(([name, value]) => {\n        validateFlagName(name);\n        return value === FeatureFlagState.Active;\n      });\n\n      return new Map(entries);\n    } catch {\n      return new Map();\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FetchApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\n/**\n * Builds a fetch API, based on the builtin fetch wrapped by a set of optional\n * middleware implementations that add behaviors.\n *\n * @remarks\n *\n * The middleware are applied in reverse order, i.e. the last one will be\n * \"closest\" to the base implementation. Passing in `[M1, M2, M3]` effectively\n * leads to `M1(M2(M3(baseImplementation)))`.\n *\n * @public\n */\nexport function createFetchApi(options: {\n  baseImplementation?: typeof fetch | undefined;\n  middleware?: FetchMiddleware | FetchMiddleware[] | undefined;\n}): FetchApi {\n  let result = options.baseImplementation || global.fetch;\n\n  const middleware = [options.middleware ?? []].flat().reverse();\n  for (const m of middleware) {\n    result = m.apply(result);\n  }\n\n  return {\n    fetch: result,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { IdentityApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\n/**\n * A fetch middleware, which injects a Backstage token header when the user is\n * signed in.\n */\nexport class IdentityAuthInjectorFetchMiddleware implements FetchMiddleware {\n  static create(options: {\n    identityApi: IdentityApi;\n    config?: Config;\n    urlPrefixAllowlist?: string[];\n    allowUrl?: (url: string) => boolean;\n    header?: {\n      name: string;\n      value: (backstageToken: string) => string;\n    };\n  }): IdentityAuthInjectorFetchMiddleware {\n    const matcher = buildMatcher(options);\n    const headerName = options.header?.name || 'authorization';\n    const headerValue = options.header?.value || (token => `Bearer ${token}`);\n\n    return new IdentityAuthInjectorFetchMiddleware(\n      options.identityApi,\n      matcher,\n      headerName,\n      headerValue,\n    );\n  }\n\n  constructor(\n    public readonly identityApi: IdentityApi,\n    public readonly allowUrl: (url: string) => boolean,\n    public readonly headerName: string,\n    public readonly headerValue: (pluginId: string) => string,\n  ) {}\n\n  apply(next: typeof fetch): typeof fetch {\n    return async (input, init) => {\n      // Skip this middleware if the header already exists, or if the URL\n      // doesn't match any of the allowlist items, or if there was no token\n      const request = new Request(input, init);\n      const { token } = await this.identityApi.getCredentials();\n      if (\n        request.headers.get(this.headerName) ||\n        typeof token !== 'string' ||\n        !token ||\n        !this.allowUrl(request.url)\n      ) {\n        return next(input, init);\n      }\n\n      request.headers.set(this.headerName, this.headerValue(token));\n      return next(request);\n    };\n  }\n}\n\nfunction buildMatcher(options: {\n  config?: Config;\n  urlPrefixAllowlist?: string[];\n  allowUrl?: (url: string) => boolean;\n}): (url: string) => boolean {\n  if (options.allowUrl) {\n    return options.allowUrl;\n  } else if (options.urlPrefixAllowlist) {\n    return buildPrefixMatcher(options.urlPrefixAllowlist);\n  } else if (options.config) {\n    return buildPrefixMatcher([options.config.getString('backend.baseUrl')]);\n  }\n  return () => false;\n}\n\nfunction buildPrefixMatcher(prefixes: string[]): (url: string) => boolean {\n  const trimmedPrefixes = prefixes.map(prefix => prefix.replace(/\\/$/, ''));\n  return url =>\n    trimmedPrefixes.some(\n      prefix => url === prefix || url.startsWith(`${prefix}/`),\n    );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\nfunction join(left: string, right: string): string {\n  if (!right || right === '/') {\n    return left;\n  }\n\n  return `${left.replace(/\\/$/, '')}/${right.replace(/^\\//, '')}`;\n}\n\n/**\n * Handles translation from plugin://some-plugin-id/<path> to concrete http(s)\n * URLs.\n */\nexport class PluginProtocolResolverFetchMiddleware implements FetchMiddleware {\n  constructor(private readonly discoveryApi: DiscoveryApi) {}\n\n  apply(next: typeof fetch): typeof fetch {\n    return async (input, init) => {\n      const request = new Request(input, init);\n      const prefix = 'plugin://';\n\n      if (!request.url.startsWith(prefix)) {\n        return next(input, init);\n      }\n\n      // Switch to a known protocol, since browser URL parsing misbehaves wildly\n      // on foreign protocols\n      const { hostname, pathname, search, hash, username, password } = new URL(\n        `http://${request.url.substring(prefix.length)}`,\n      );\n\n      let base = await this.discoveryApi.getBaseUrl(hostname);\n      if (username || password) {\n        const baseUrl = new URL(base);\n        const authority = `${username}${password ? `:${password}` : ''}@`;\n        base = `${baseUrl.protocol}//${authority}${baseUrl.host}${baseUrl.pathname}`;\n      }\n\n      const target = `${join(base, pathname)}${search}${hash}`;\n      return next(target, request);\n    };\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\nimport { IdentityAuthInjectorFetchMiddleware } from './IdentityAuthInjectorFetchMiddleware';\nimport { PluginProtocolResolverFetchMiddleware } from './PluginProtocolResolverFetchMiddleware';\nimport { FetchMiddleware } from './types';\n\n/**\n * A collection of common middlewares for the FetchApi.\n *\n * @public\n */\nexport class FetchMiddlewares {\n  /**\n   * Handles translation from `plugin://` URLs to concrete http(s) URLs based on\n   * the discovery API.\n   *\n   * @remarks\n   *\n   * If the request is for `plugin://catalog/entities?filter=x=y`, the discovery\n   * API will be queried for `'catalog'`. If it returned\n   * `https://backstage.example.net/api/catalog`, the resulting query would be\n   * `https://backstage.example.net/api/catalog/entities?filter=x=y`.\n   *\n   * If the incoming URL protocol was not `plugin`, the request is just passed\n   * through verbatim to the underlying implementation.\n   */\n  static resolvePluginProtocol(options: {\n    discoveryApi: DiscoveryApi;\n  }): FetchMiddleware {\n    return new PluginProtocolResolverFetchMiddleware(options.discoveryApi);\n  }\n\n  /**\n   * Injects a Backstage token header when the user is signed in.\n   *\n   * @remarks\n   *\n   * Per default, an `Authorization: Bearer <token>` is generated. This can be\n   * customized using the `header` option.\n   *\n   * The header injection only happens on allowlisted URLs. Per default, if the\n   * `config` option is passed in, the `backend.baseUrl` is allowlisted, unless\n   * the `urlPrefixAllowlist` or `allowUrl` options are passed in, in which case\n   * they take precedence. If you pass in neither config nor an\n   * allowlist/callback, the middleware will have no effect since effectively no\n   * request will match the (nonexistent) rules.\n   */\n  static injectIdentityAuth(options: {\n    identityApi: IdentityApi;\n    config?: Config;\n    urlPrefixAllowlist?: string[];\n    allowUrl?: (url: string) => boolean;\n    header?: {\n      name: string;\n      value: (backstageToken: string) => string;\n    };\n  }): FetchMiddleware {\n    return IdentityAuthInjectorFetchMiddleware.create(options);\n  }\n\n  private constructor() {}\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\ntype RequestQueueEntry<ResultType> = {\n  scopes: Set<string>;\n  resolve: (value: ResultType | PromiseLike<ResultType>) => void;\n  reject: (reason: Error) => void;\n};\n\nexport type PendingRequest<ResultType> = {\n  scopes: Set<string> | undefined;\n  resolve: (value: ResultType) => void;\n  reject: (reason: Error) => void;\n};\n\nexport function hasScopes(\n  searched: Set<string>,\n  searchFor: Set<string>,\n): boolean {\n  for (const scope of searchFor) {\n    if (!searched.has(scope)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function joinScopes(\n  scopes: Set<string>,\n  ...moreScopess: Set<string>[]\n): Set<string> {\n  const result = new Set(scopes);\n\n  for (const moreScopes of moreScopess) {\n    for (const scope of moreScopes) {\n      result.add(scope);\n    }\n  }\n\n  return result;\n}\n\n/**\n * The OAuthPendingRequests class is a utility for managing and observing\n * a stream of requests for oauth scopes for a single provider, and resolving\n * them correctly once requests are fulfilled.\n */\nexport class OAuthPendingRequests<ResultType> {\n  private requests: RequestQueueEntry<ResultType>[] = [];\n  private subject = new BehaviorSubject<PendingRequest<ResultType>>(\n    this.getCurrentPending(),\n  );\n\n  request(scopes: Set<string>): Promise<ResultType> {\n    return new Promise((resolve, reject) => {\n      this.requests.push({ scopes, resolve, reject });\n\n      this.subject.next(this.getCurrentPending());\n    });\n  }\n\n  resolve(scopes: Set<string>, result: ResultType): void {\n    this.requests = this.requests.filter(request => {\n      if (hasScopes(scopes, request.scopes)) {\n        request.resolve(result);\n        return false;\n      }\n      return true;\n    });\n\n    this.subject.next(this.getCurrentPending());\n  }\n\n  reject(error: Error) {\n    this.requests.forEach(request => request.reject(error));\n    this.requests = [];\n\n    this.subject.next(this.getCurrentPending());\n  }\n\n  pending(): Observable<PendingRequest<ResultType>> {\n    return this.subject;\n  }\n\n  private getCurrentPending(): PendingRequest<ResultType> {\n    const currentScopes =\n      this.requests.length === 0\n        ? undefined\n        : this.requests\n            .slice(1)\n            .reduce(\n              (acc, current) => joinScopes(acc, current.scopes),\n              this.requests[0].scopes,\n            );\n\n    return {\n      scopes: currentScopes,\n      resolve: (value: ResultType) => {\n        if (currentScopes) {\n          this.resolve(currentScopes, value);\n        }\n      },\n      reject: (reason: Error) => {\n        if (currentScopes) {\n          this.reject(reason);\n        }\n      },\n    };\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  OAuthRequestApi,\n  PendingOAuthRequest,\n  OAuthRequester,\n  OAuthRequesterOptions,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { OAuthPendingRequests, PendingRequest } from './OAuthPendingRequests';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\n/**\n * The OAuthRequestManager is an implementation of the OAuthRequestApi.\n *\n * The purpose of this class and the API is to read a stream of incoming requests\n * of OAuth access tokens from different providers with varying scope, and funnel\n * them all together into a single request for each OAuth provider.\n *\n * @public\n */\nexport class OAuthRequestManager implements OAuthRequestApi {\n  private readonly subject = new BehaviorSubject<PendingOAuthRequest[]>([]);\n  private currentRequests: PendingOAuthRequest[] = [];\n  private handlerCount = 0;\n\n  createAuthRequester<T>(options: OAuthRequesterOptions<T>): OAuthRequester<T> {\n    const handler = new OAuthPendingRequests<T>();\n\n    const index = this.handlerCount;\n    this.handlerCount++;\n\n    handler.pending().subscribe({\n      next: scopeRequest => {\n        const newRequests = this.currentRequests.slice();\n        const request = this.makeAuthRequest(scopeRequest, options);\n        if (!request) {\n          delete newRequests[index];\n        } else {\n          newRequests[index] = request;\n        }\n        this.currentRequests = newRequests;\n        // Convert from sparse array to array of present items only\n        this.subject.next(newRequests.filter(Boolean));\n      },\n    });\n\n    return scopes => {\n      return handler.request(scopes);\n    };\n  }\n\n  // Converts the pending request and popup options into a popup request that we can forward to subscribers.\n  private makeAuthRequest(\n    request: PendingRequest<any>,\n    options: OAuthRequesterOptions<any>,\n  ): PendingOAuthRequest | undefined {\n    const { scopes } = request;\n    if (!scopes) {\n      return undefined;\n    }\n\n    return {\n      provider: options.provider,\n      trigger: async () => {\n        const result = await options.onAuthRequest(scopes);\n        request.resolve(result);\n      },\n      reject: () => {\n        const error = new Error('Login failed, rejected by user');\n        error.name = 'RejectedError';\n        request.reject(error);\n      },\n    };\n  }\n\n  authRequest$(): Observable<PendingOAuthRequest[]> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  StorageApi,\n  StorageValueSnapshot,\n  ErrorApi,\n} from '@backstage/core-plugin-api';\nimport { JsonValue, Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\n\nconst buckets = new Map<string, WebStorage>();\n\n/**\n * An implementation of the storage API, that uses the browser's local storage.\n *\n * @public\n */\nexport class WebStorage implements StorageApi {\n  constructor(\n    private readonly namespace: string,\n    private readonly errorApi: ErrorApi,\n  ) {}\n\n  static create(options: {\n    errorApi: ErrorApi;\n    namespace?: string;\n  }): WebStorage {\n    return new WebStorage(options.namespace ?? '', options.errorApi);\n  }\n\n  get<T>(key: string): T | undefined {\n    return this.snapshot(key).value as T | undefined;\n  }\n\n  snapshot<T extends JsonValue>(key: string): StorageValueSnapshot<T> {\n    let value = undefined;\n    let presence: 'present' | 'absent' = 'absent';\n    try {\n      const item = localStorage.getItem(this.getKeyName(key));\n      if (item) {\n        value = JSON.parse(item, (_key, val) => {\n          if (typeof val === 'object' && val !== null) {\n            Object.freeze(val);\n          }\n          return val;\n        });\n        presence = 'present';\n      }\n    } catch (e) {\n      this.errorApi.post(\n        new Error(`Error when parsing JSON config from storage for: ${key}`),\n      );\n    }\n    return { key, value, presence };\n  }\n\n  forBucket(name: string): WebStorage {\n    const bucketPath = `${this.namespace}/${name}`;\n    if (!buckets.has(bucketPath)) {\n      buckets.set(bucketPath, new WebStorage(bucketPath, this.errorApi));\n    }\n    return buckets.get(bucketPath)!;\n  }\n\n  async set<T>(key: string, data: T): Promise<void> {\n    localStorage.setItem(this.getKeyName(key), JSON.stringify(data));\n    this.notifyChanges(key);\n  }\n\n  async remove(key: string): Promise<void> {\n    localStorage.removeItem(this.getKeyName(key));\n    this.notifyChanges(key);\n  }\n\n  observe$<T>(key: string): Observable<StorageValueSnapshot<T>> {\n    return this.observable.filter(({ key: messageKey }) => messageKey === key);\n  }\n\n  private getKeyName(key: string) {\n    return `${this.namespace}/${encodeURIComponent(key)}`;\n  }\n\n  private notifyChanges(key: string) {\n    const snapshot = this.snapshot(key);\n    for (const subscription of this.subscribers) {\n      subscription.next(snapshot);\n    }\n  }\n\n  private subscribers = new Set<\n    ZenObservable.SubscriptionObserver<StorageValueSnapshot<JsonValue>>\n  >();\n\n  private readonly observable = new ObservableImpl<\n    StorageValueSnapshot<JsonValue>\n  >(subscriber => {\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isValidElement, ReactNode, ReactElement, Children } from 'react';\n\nexport type Discoverer = (element: ReactElement) => ReactNode;\n\nexport type Collector<Result, Context> = () => {\n  accumulator: Result;\n  visit(\n    accumulator: Result,\n    element: ReactElement,\n    parent: ReactElement | undefined,\n    context: Context,\n  ): Context;\n};\n\n/**\n * A function that allows you to traverse a tree of React elements using\n * varying methods to discover child nodes and collect data along the way.\n */\nexport function traverseElementTree<Results>(options: {\n  root: ReactNode;\n  discoverers: Discoverer[];\n  collectors: { [name in keyof Results]: Collector<Results[name], any> };\n}): Results {\n  const collectors: {\n    [name in string]: ReturnType<Collector<any, any>>;\n  } = {};\n\n  // Bootstrap all collectors, initializing the accumulators and providing the visitor function\n  for (const name in options.collectors) {\n    if (options.collectors.hasOwnProperty(name)) {\n      collectors[name] = options.collectors[name]();\n    }\n  }\n\n  // Internal representation of an element in the tree that we're iterating over\n  type QueueItem = {\n    node: ReactNode;\n    parent: ReactElement | undefined;\n    contexts: { [name in string]: unknown };\n  };\n\n  const queue = [\n    {\n      node: Children.toArray(options.root),\n      parent: undefined,\n      contexts: {},\n    } as QueueItem,\n  ];\n\n  while (queue.length !== 0) {\n    const { node, parent, contexts } = queue.shift()!;\n\n    // While the parent and the element we pass on to collectors and discoverers\n    // have been validated and are known to be React elements, the child nodes\n    // emitted by the discoverers are not.\n    Children.forEach(node, element => {\n      if (!isValidElement(element)) {\n        return;\n      }\n\n      const nextContexts: QueueItem['contexts'] = {};\n\n      // Collectors populate their result data using the current node, and compute\n      // context for the next iteration\n      for (const name in collectors) {\n        if (collectors.hasOwnProperty(name)) {\n          const collector = collectors[name];\n\n          nextContexts[name] = collector.visit(\n            collector.accumulator,\n            element,\n            parent,\n            contexts[name],\n          );\n        }\n      }\n\n      // Discoverers provide ways to continue the traversal from the current element\n      for (const discoverer of options.discoverers) {\n        const children = discoverer(element);\n        if (children) {\n          queue.push({\n            node: children,\n            parent: element,\n            contexts: nextContexts,\n          });\n        }\n      }\n    });\n  }\n\n  return Object.fromEntries(\n    Object.entries(collectors).map(([name, c]) => [name, c.accumulator]),\n  ) as Results;\n}\n\nexport function createCollector<Result, Context>(\n  accumulatorFactory: () => Result,\n  visit: ReturnType<Collector<Result, Context>>['visit'],\n): Collector<Result, Context> {\n  return () => ({ accumulator: accumulatorFactory(), visit });\n}\n\nexport function childDiscoverer(element: ReactElement): ReactNode {\n  return element.props?.children;\n}\n\nexport function routeElementDiscoverer(element: ReactElement): ReactNode {\n  if (element.props?.path && element.props?.element) {\n    return element.props?.element;\n  }\n  return undefined;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstagePlugin, getComponentData } from '@backstage/core-plugin-api';\nimport { createCollector } from '../extensions/traversal';\n\nexport const pluginCollector = createCollector(\n  () => new Set<BackstagePlugin<any, any>>(),\n  (acc, node) => {\n    const plugin = getComponentData<BackstagePlugin<any, any>>(\n      node,\n      'core.plugin',\n    );\n    if (plugin) {\n      acc.add(plugin);\n    }\n  },\n);\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  featureFlagsApiRef,\n  useApi,\n  attachComponentData,\n} from '@backstage/core-plugin-api';\nimport React, { ReactNode } from 'react';\n\n/**\n * Props for the {@link FeatureFlagged} component.\n *\n * @public\n */\nexport type FeatureFlaggedProps = { children: ReactNode } & (\n  | { with: string }\n  | { without: string }\n);\n\n/**\n * Enables or disables rendering of its children based on the state of a given\n * feature flag.\n *\n * @public\n */\nexport const FeatureFlagged = (props: FeatureFlaggedProps) => {\n  const { children } = props;\n  const featureFlagApi = useApi(featureFlagsApiRef);\n  const isEnabled =\n    'with' in props\n      ? featureFlagApi.isActive(props.with)\n      : !featureFlagApi.isActive(props.without);\n  return <>{isEnabled ? children : null}</>;\n};\n\nattachComponentData(FeatureFlagged, 'core.featureFlagged', true);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isValidElement, ReactElement, ReactNode } from 'react';\nimport {\n  RouteRef,\n  getComponentData,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { BackstageRouteObject } from './types';\nimport { createCollector } from '../extensions/traversal';\nimport { FeatureFlagged, FeatureFlaggedProps } from './FeatureFlagged';\n\nfunction getMountPoint(node: ReactElement): RouteRef | undefined {\n  const element: ReactNode = node.props?.element;\n\n  let routeRef = getComponentData<RouteRef>(node, 'core.mountPoint');\n  if (!routeRef && isValidElement(element)) {\n    routeRef = getComponentData<RouteRef>(element, 'core.mountPoint');\n  }\n\n  return routeRef;\n}\n\nexport const routePathCollector = createCollector(\n  () => new Map<RouteRef, string>(),\n  (acc, node, parent, ctxPath: string | undefined) => {\n    // The context path is used during mount point gathering to assign the same path\n    // to all discovered mount points\n    let currentCtxPath = ctxPath;\n\n    if (parent?.props.element === node) {\n      return currentCtxPath;\n    }\n\n    // Start gathering mount points when we encounter a mount point gathering flag\n    if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n      const path: string | undefined = node.props?.path;\n      if (!path) {\n        throw new Error('Mount point gatherer must have a path');\n      }\n      currentCtxPath = path;\n    }\n\n    const routeRef = getMountPoint(node);\n    if (routeRef) {\n      let path: string | undefined = node.props?.path;\n      // If we're gathering mount points we use the context path as out path, unless\n      // the element has its own path, in which case we use that instead and stop gathering\n      if (currentCtxPath) {\n        if (path) {\n          currentCtxPath = undefined;\n        } else {\n          path = currentCtxPath;\n        }\n      }\n      if (!path) {\n        throw new Error('Mounted routable extension must have a path');\n      }\n      acc.set(routeRef, path);\n    }\n    return currentCtxPath;\n  },\n);\n\nexport const routeParentCollector = createCollector(\n  () => new Map<RouteRef, RouteRef | undefined>(),\n  (acc, node, parent, parentRouteRef?: RouteRef | { sticky: RouteRef }) => {\n    if (parent?.props.element === node) {\n      return parentRouteRef;\n    }\n\n    let nextParent = parentRouteRef;\n\n    const routeRef = getMountPoint(node);\n    if (routeRef) {\n      // \"sticky\" route ref is when we've encountered a mount point gatherer, and we want a\n      // mount points beneath it to have the same parent, regardless of internal structure\n      if (parentRouteRef && 'sticky' in parentRouteRef) {\n        acc.set(routeRef, parentRouteRef.sticky);\n\n        // When we encounter a mount point with an explicit path, we stop gathering\n        // mount points within the children and remove the sticky state\n        if (node.props?.path) {\n          nextParent = routeRef;\n        } else {\n          nextParent = parentRouteRef;\n        }\n      } else {\n        acc.set(routeRef, parentRouteRef);\n        nextParent = routeRef;\n      }\n    }\n\n    // Mount point gatherers are marked as \"sticky\"\n    if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n      return { sticky: nextParent };\n    }\n\n    return nextParent;\n  },\n);\n\n// We always add a child that matches all subroutes but without any route refs. This makes\n// sure that we're always able to match each route no matter how deep the navigation goes.\n// The route resolver then takes care of selecting the most specific match in order to find\n// mount points that are as deep in the routing tree as possible.\nexport const MATCH_ALL_ROUTE: BackstageRouteObject = {\n  caseSensitive: false,\n  path: '/*',\n  element: 'match-all', // These elements aren't used, so we add in a bit of debug information\n  routeRefs: new Set(),\n};\n\nexport const routeObjectCollector = createCollector(\n  () => Array<BackstageRouteObject>(),\n  (acc, node, parent, parentObj: BackstageRouteObject | undefined) => {\n    const parentChildren = parentObj?.children ?? acc;\n    if (parent?.props.element === node) {\n      return parentObj;\n    }\n\n    const path: string | undefined = node.props?.path;\n    const caseSensitive: boolean = Boolean(node.props?.caseSensitive);\n\n    const routeRef = getMountPoint(node);\n    if (routeRef) {\n      if (path) {\n        const newObject: BackstageRouteObject = {\n          caseSensitive,\n          path,\n          element: 'mounted',\n          routeRefs: new Set([routeRef]),\n          children: [MATCH_ALL_ROUTE],\n          plugin: getComponentData<BackstagePlugin>(\n            node.props.element,\n            'core.plugin',\n          ),\n        };\n        parentChildren.push(newObject);\n        return newObject;\n      }\n\n      parentObj?.routeRefs.add(routeRef);\n    }\n\n    const isGatherer = getComponentData<boolean>(\n      node,\n      'core.gatherMountPoints',\n    );\n    if (isGatherer) {\n      if (!path) {\n        throw new Error('Mount point gatherer must have a path');\n      }\n      const newObject: BackstageRouteObject = {\n        caseSensitive,\n        path,\n        element: 'gathered',\n        routeRefs: new Set(),\n        children: [MATCH_ALL_ROUTE],\n        plugin: parentObj?.plugin,\n      };\n      parentChildren.push(newObject);\n      return newObject;\n    }\n\n    return parentObj;\n  },\n);\n\nexport const featureFlagCollector = createCollector(\n  () => new Set<string>(),\n  (acc, node) => {\n    if (node.type === FeatureFlagged) {\n      const props = node.props as FeatureFlaggedProps;\n      acc.add('with' in props ? props.with : props.without);\n    }\n  },\n);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\ntype RouteRefType = Exclude<\n  keyof RouteRef,\n  'params' | 'path' | 'title' | 'icon'\n>;\nexport const routeRefType: RouteRefType = getOrCreateGlobalSingleton<any>(\n  'route-ref-type',\n  () => Symbol('route-ref-type'),\n);\n\nexport type AnyParams = { [param in string]: string } | undefined;\n\nexport type AnyRouteRef =\n  | RouteRef<any>\n  | SubRouteRef<any>\n  | ExternalRouteRef<any, any>;\n\n// The extra TS magic here is to require a single params argument if the RouteRef\n// had at least one param defined, but require 0 arguments if there are no params defined.\n// Without this we'd have to pass in empty object to all parameter-less RouteRefs\n// just to make TypeScript happy, or we would have to make the argument optional in\n// which case you might forget to pass it in when it is actually required.\nexport type RouteFunc<Params extends AnyParams> = (\n  ...[params]: Params extends undefined ? readonly [] : readonly [Params]\n) => string;\n\n// A duplicate of the react-router RouteObject, but with routeRef added\nexport interface BackstageRouteObject {\n  caseSensitive: boolean;\n  children?: BackstageRouteObject[];\n  element: React.ReactNode;\n  path: string;\n  routeRefs: Set<RouteRef>;\n  plugin?: BackstagePlugin;\n}\n\nexport function isRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): routeRef is RouteRef<Params> {\n  return routeRef[routeRefType] === 'absolute';\n}\n\nexport function isSubRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): routeRef is SubRouteRef<Params> {\n  return routeRef[routeRefType] === 'sub';\n}\n\nexport function isExternalRouteRef<\n  Params extends AnyParams,\n  Optional extends boolean,\n>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, Optional>,\n): routeRef is ExternalRouteRef<Params, Optional> {\n  return routeRef[routeRefType] === 'external';\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generatePath, matchRoutes } from 'react-router-dom';\nimport {\n  AnyRouteRef,\n  BackstageRouteObject,\n  AnyParams,\n  RouteFunc,\n  routeRefType,\n  isRouteRef,\n  isSubRouteRef,\n  isExternalRouteRef,\n} from './types';\nimport {\n  RouteRef,\n  ExternalRouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\n\n// Joins a list of paths together, avoiding trailing and duplicate slashes\nfunction joinPaths(...paths: string[]): string {\n  const normalized = paths.join('/').replace(/\\/\\/+/g, '/');\n  if (normalized !== '/' && normalized.endsWith('/')) {\n    return normalized.slice(0, -1);\n  }\n  return normalized;\n}\n\n/**\n * Resolves the absolute route ref that our target route ref is pointing pointing to, as well\n * as the relative target path.\n *\n * Returns an undefined target ref if one could not be fully resolved.\n */\nfunction resolveTargetRef(\n  anyRouteRef: AnyRouteRef,\n  routePaths: Map<RouteRef, string>,\n  routeBindings: Map<AnyRouteRef, AnyRouteRef | undefined>,\n): readonly [RouteRef | undefined, string] {\n  // First we figure out which absolute route ref we're dealing with, an if there was an sub route path to append.\n  // For sub routes it will be the parent path, while for external routes it will be the bound route.\n  let targetRef: RouteRef;\n  let subRoutePath = '';\n  if (isRouteRef(anyRouteRef)) {\n    targetRef = anyRouteRef;\n  } else if (isSubRouteRef(anyRouteRef)) {\n    targetRef = anyRouteRef.parent;\n    subRoutePath = anyRouteRef.path;\n  } else if (isExternalRouteRef(anyRouteRef)) {\n    const resolvedRoute = routeBindings.get(anyRouteRef);\n    if (!resolvedRoute) {\n      return [undefined, ''];\n    }\n    if (isRouteRef(resolvedRoute)) {\n      targetRef = resolvedRoute;\n    } else if (isSubRouteRef(resolvedRoute)) {\n      targetRef = resolvedRoute.parent;\n      subRoutePath = resolvedRoute.path;\n    } else {\n      throw new Error(\n        `ExternalRouteRef was bound to invalid target, ${resolvedRoute}`,\n      );\n    }\n  } else if (anyRouteRef[routeRefType]) {\n    throw new Error(\n      `Unknown or invalid route ref type, ${anyRouteRef[routeRefType]}`,\n    );\n  } else {\n    throw new Error(`Unknown object passed to useRouteRef, got ${anyRouteRef}`);\n  }\n\n  // Bail if no absolute path could be resolved\n  if (!targetRef) {\n    return [undefined, ''];\n  }\n\n  // Find the path that our target route is bound to\n  const resolvedPath = routePaths.get(targetRef);\n  if (!resolvedPath) {\n    return [undefined, ''];\n  }\n\n  // SubRouteRefs join the path from the parent route with its own path\n  const targetPath = joinPaths(resolvedPath, subRoutePath);\n  return [targetRef, targetPath];\n}\n\n/**\n * Resolves the complete base path for navigating to the target RouteRef.\n */\nfunction resolveBasePath(\n  targetRef: RouteRef,\n  sourceLocation: Parameters<typeof matchRoutes>[1],\n  routePaths: Map<RouteRef, string>,\n  routeParents: Map<RouteRef, RouteRef | undefined>,\n  routeObjects: BackstageRouteObject[],\n) {\n  // While traversing the app element tree we build up the routeObjects structure\n  // used here. It is the same kind of structure that react-router creates, with the\n  // addition that associated route refs are stored throughout the tree. This lets\n  // us look up all route refs that can be reached from our source location.\n  // Because of the similar route object structure, we can use `matchRoutes` from\n  // react-router to do the lookup of our current location.\n  const match = matchRoutes(routeObjects, sourceLocation) ?? [];\n\n  // While we search for a common routing root between our current location and\n  // the target route, we build a list of all route refs we find that we need\n  // to traverse to reach the target.\n  const refDiffList = Array<RouteRef>();\n\n  let matchIndex = -1;\n  for (\n    let targetSearchRef: RouteRef | undefined = targetRef;\n    targetSearchRef;\n    targetSearchRef = routeParents.get(targetSearchRef)\n  ) {\n    // The match contains a list of all ancestral route refs present at our current location\n    // Starting at the desired target ref and traversing back through its parents, we search\n    // for a target ref that is present in the match for our current location. When a match\n    // is found it means we have found a common base to resolve the route from.\n    matchIndex = match.findIndex(m =>\n      (m.route as BackstageRouteObject).routeRefs.has(targetSearchRef!),\n    );\n    if (matchIndex !== -1) {\n      break;\n    }\n\n    // Every time we move a step up in the ancestry of the target ref, we add the current ref\n    // to the diff list, which ends up being the list of route refs to traverse form the common base\n    // in order to reach our target.\n    refDiffList.unshift(targetSearchRef);\n  }\n\n  // If our target route is present in the initial match we need to construct the final path\n  // from the parent of the matched route segment. That's to allow the caller of the route\n  // function to supply their own params.\n  if (refDiffList.length === 0) {\n    matchIndex -= 1;\n  }\n\n  // This is the part of the route tree that the target and source locations have in common.\n  // We re-use the existing pathname directly along with all params.\n  const parentPath = matchIndex === -1 ? '' : match[matchIndex].pathname;\n\n  // This constructs the mid section of the path using paths resolved from all route refs\n  // we need to traverse to reach our target except for the very last one. None of these\n  // paths are allowed to require any parameters, as the caller would have no way of knowing\n  // what parameters those are.\n  const diffPath = joinPaths(\n    ...refDiffList.slice(0, -1).map(ref => {\n      const path = routePaths.get(ref);\n      if (!path) {\n        throw new Error(`No path for ${ref}`);\n      }\n      if (path.includes(':')) {\n        throw new Error(\n          `Cannot route to ${targetRef} with parent ${ref} as it has parameters`,\n        );\n      }\n      return path;\n    }),\n  );\n\n  return parentPath + diffPath;\n}\n\nexport class RouteResolver {\n  constructor(\n    private readonly routePaths: Map<RouteRef, string>,\n    private readonly routeParents: Map<RouteRef, RouteRef | undefined>,\n    private readonly routeObjects: BackstageRouteObject[],\n    private readonly routeBindings: Map<\n      ExternalRouteRef,\n      RouteRef | SubRouteRef\n    >,\n    private readonly appBasePath: string, // base path without a trailing slash\n  ) {}\n\n  resolve<Params extends AnyParams>(\n    anyRouteRef:\n      | RouteRef<Params>\n      | SubRouteRef<Params>\n      | ExternalRouteRef<Params, any>,\n    sourceLocation: Parameters<typeof matchRoutes>[1],\n  ): RouteFunc<Params> | undefined {\n    // First figure out what our target absolute ref is, as well as our target path.\n    const [targetRef, targetPath] = resolveTargetRef(\n      anyRouteRef,\n      this.routePaths,\n      this.routeBindings,\n    );\n    if (!targetRef) {\n      return undefined;\n    }\n\n    // The location that we get passed in uses the full path, so start by trimming off\n    // the app base path prefix in case we're running the app on a sub-path.\n    let relativeSourceLocation: Parameters<typeof matchRoutes>[1];\n    if (typeof sourceLocation === 'string') {\n      relativeSourceLocation = this.trimPath(sourceLocation);\n    } else if (sourceLocation.pathname) {\n      relativeSourceLocation = {\n        ...sourceLocation,\n        pathname: this.trimPath(sourceLocation.pathname),\n      };\n    } else {\n      relativeSourceLocation = sourceLocation;\n    }\n\n    // Next we figure out the base path, which is the combination of the common parent path\n    // between our current location and our target location, as well as the additional path\n    // that is the difference between the parent path and the base of our target location.\n    const basePath =\n      this.appBasePath +\n      resolveBasePath(\n        targetRef,\n        relativeSourceLocation,\n        this.routePaths,\n        this.routeParents,\n        this.routeObjects,\n      );\n\n    const routeFunc: RouteFunc<Params> = (...[params]) => {\n      return basePath + generatePath(targetPath, params);\n    };\n    return routeFunc;\n  }\n\n  private trimPath(targetPath: string) {\n    if (!targetPath) {\n      return targetPath;\n    }\n\n    if (targetPath.startsWith(this.appBasePath)) {\n      return targetPath.slice(this.appBasePath.length);\n    }\n    return targetPath;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport {\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\nimport { RouteResolver } from './RouteResolver';\nimport { BackstageRouteObject } from './types';\n\nconst RoutingContext =\n  createVersionedContext<{ 1: RouteResolver }>('routing-context');\n\ntype ProviderProps = {\n  routePaths: Map<RouteRef, string>;\n  routeParents: Map<RouteRef, RouteRef | undefined>;\n  routeObjects: BackstageRouteObject[];\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>;\n  basePath?: string;\n  children: ReactNode;\n};\n\nexport const RoutingProvider = ({\n  routePaths,\n  routeParents,\n  routeObjects,\n  routeBindings,\n  basePath = '',\n  children,\n}: ProviderProps) => {\n  const resolver = new RouteResolver(\n    routePaths,\n    routeParents,\n    routeObjects,\n    routeBindings,\n    basePath,\n  );\n\n  const versionedValue = createVersionedValueMap({ 1: resolver });\n  return (\n    <RoutingContext.Provider value={versionedValue}>\n      {children}\n    </RoutingContext.Provider>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useMemo } from 'react';\nimport { matchRoutes, useLocation } from 'react-router-dom';\nimport {\n  useAnalytics,\n  AnalyticsContext,\n  CommonAnalyticsContext,\n  RouteRef,\n} from '@backstage/core-plugin-api';\nimport { routeObjectCollector } from './collectors';\nimport {\n  childDiscoverer,\n  routeElementDiscoverer,\n  traverseElementTree,\n} from '../extensions/traversal';\nimport { BackstageRouteObject } from './types';\n\n/**\n * Returns an extension context given the current pathname and a list of\n * Backstage route objects.\n */\nconst getExtensionContext = (\n  pathname: string,\n  routes: BackstageRouteObject[],\n): CommonAnalyticsContext | {} => {\n  try {\n    // Find matching routes for the given path name.\n    const matches = matchRoutes(routes, { pathname }) as\n      | { route: BackstageRouteObject }[]\n      | null;\n\n    // Of the matching routes, get the last (e.g. most specific) instance of\n    // the BackstageRouteObject.\n    const routeObject = matches\n      ?.filter(match => match?.route.routeRefs?.size > 0)\n      .pop()?.route;\n\n    // If there is no route object, then allow inheritance of default context.\n    if (!routeObject) {\n      return {};\n    }\n\n    // If there is a single route ref, return it.\n    // todo: get routeRef of rendered gathered mount point(?)\n    let routeRef: RouteRef | undefined;\n    if (routeObject.routeRefs.size === 1) {\n      routeRef = routeObject.routeRefs.values().next().value;\n    }\n\n    return {\n      extension: 'App',\n      pluginId: routeObject.plugin?.getId() || 'root',\n      ...(routeRef ? { routeRef: (routeRef as { id?: string }).id } : {}),\n    };\n  } catch {\n    return {};\n  }\n};\n\n/**\n * Performs the actual event capture on render.\n */\nconst TrackNavigation = ({\n  pathname,\n  search,\n  hash,\n}: {\n  pathname: string;\n  search: string;\n  hash: string;\n}) => {\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    analytics.captureEvent('navigate', `${pathname}${search}${hash}`);\n  }, [analytics, pathname, search, hash]);\n\n  return null;\n};\n\n/**\n * Logs a \"navigate\" event with appropriate plugin-level analytics context\n * attributes each time the user navigates to a page.\n */\nexport const RouteTracker = ({ tree }: { tree: React.ReactNode }) => {\n  const { pathname, search, hash } = useLocation();\n  // todo(iamEAP): Work this into the existing traversal and make the data\n  // available on the provider. Then grab from app instance on the router.\n  const { routeObjects } = useMemo(() => {\n    return traverseElementTree({\n      root: tree,\n      discoverers: [childDiscoverer, routeElementDiscoverer],\n      collectors: {\n        routeObjects: routeObjectCollector,\n      },\n    });\n  }, [tree]);\n\n  return (\n    <AnalyticsContext attributes={getExtensionContext(pathname, routeObjects)}>\n      <TrackNavigation pathname={pathname} search={search} hash={hash} />\n    </AnalyticsContext>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstagePlugin,\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport { AnyRouteRef } from './types';\n\n// Validates that there is no duplication of route parameter names\nexport function validateRouteParameters(\n  routePaths: Map<AnyRouteRef, string>,\n  routeParents: Map<AnyRouteRef, AnyRouteRef | undefined>,\n) {\n  const notLeafRoutes = new Set(routeParents.values());\n  notLeafRoutes.delete(undefined);\n\n  for (const route of routeParents.keys()) {\n    if (notLeafRoutes.has(route)) {\n      continue;\n    }\n\n    let currentRouteRef: AnyRouteRef | undefined = route;\n\n    let fullPath = '';\n    while (currentRouteRef) {\n      const path = routePaths.get(currentRouteRef);\n      if (!path) {\n        throw new Error(`No path for ${currentRouteRef}`);\n      }\n      fullPath = `${path}${fullPath}`;\n      currentRouteRef = routeParents.get(currentRouteRef);\n    }\n\n    const params = fullPath.match(/:(\\w+)/g);\n    if (params) {\n      for (let j = 0; j < params.length; j++) {\n        for (let i = j + 1; i < params.length; i++) {\n          if (params[i] === params[j]) {\n            throw new Error(\n              `Parameter ${params[i]} is duplicated in path ${fullPath}`,\n            );\n          }\n        }\n      }\n    }\n  }\n}\n\n// Validates that all non-optional external routes have been bound\nexport function validateRouteBindings(\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>,\n  plugins: Iterable<BackstagePlugin<{}, Record<string, ExternalRouteRef>>>,\n) {\n  for (const plugin of plugins) {\n    if (!plugin.externalRoutes) {\n      continue;\n    }\n\n    for (const [name, externalRouteRef] of Object.entries(\n      plugin.externalRoutes,\n    )) {\n      if (externalRouteRef.optional) {\n        continue;\n      }\n\n      if (!routeBindings.has(externalRouteRef)) {\n        throw new Error(\n          `External route '${name}' of the '${plugin.getId()}' plugin must be bound to a target route. ` +\n            'See https://backstage.io/link?bind-routes for details.',\n        );\n      }\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\nimport { AppContext as AppContextV1 } from './types';\n\nconst AppContext = createVersionedContext<{ 1: AppContextV1 }>('app-context');\n\ntype Props = {\n  appContext: AppContextV1;\n};\n\nexport const AppContextProvider = ({\n  appContext,\n  children,\n}: PropsWithChildren<Props>) => {\n  const versionedValue = createVersionedValueMap({ 1: appContext });\n\n  return <AppContext.Provider value={versionedValue} children={children} />;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  IdentityApi,\n  ProfileInfo,\n  BackstageUserIdentity,\n} from '@backstage/core-plugin-api';\n\nfunction mkError(thing: string) {\n  return new Error(\n    `Tried to access IdentityApi ${thing} before app was loaded`,\n  );\n}\n\nfunction logDeprecation(thing: string) {\n  // eslint-disable-next-line no-console\n  console.warn(\n    `WARNING: Call to ${thing} is deprecated and will break in the future`,\n  );\n}\n\n// We use this for a period of backwards compatibility. It is a hidden\n// compatibility that will allow old plugins to continue working for a limited time.\ntype CompatibilityIdentityApi = IdentityApi & {\n  getUserId?(): string;\n  getIdToken?(): Promise<string | undefined>;\n  getProfile?(): ProfileInfo;\n};\n\n/**\n * Implementation of the connection between the App-wide IdentityApi\n * and sign-in page.\n */\nexport class AppIdentityProxy implements IdentityApi {\n  private target?: CompatibilityIdentityApi;\n  private waitForTarget: Promise<CompatibilityIdentityApi>;\n  private resolveTarget: (api: CompatibilityIdentityApi) => void = () => {};\n\n  constructor() {\n    this.waitForTarget = new Promise<CompatibilityIdentityApi>(resolve => {\n      this.resolveTarget = resolve;\n    });\n  }\n\n  // This is called by the app manager once the sign-in page provides us with an implementation\n  setTarget(identityApi: CompatibilityIdentityApi) {\n    this.target = identityApi;\n    this.resolveTarget(identityApi);\n  }\n\n  getUserId(): string {\n    if (!this.target) {\n      throw mkError('getUserId');\n    }\n    if (!this.target.getUserId) {\n      throw new Error('IdentityApi does not implement getUserId');\n    }\n    logDeprecation('getUserId');\n    return this.target.getUserId();\n  }\n\n  getProfile(): ProfileInfo {\n    if (!this.target) {\n      throw mkError('getProfile');\n    }\n    if (!this.target.getProfile) {\n      throw new Error('IdentityApi does not implement getProfile');\n    }\n    logDeprecation('getProfile');\n    return this.target.getProfile();\n  }\n\n  async getProfileInfo(): Promise<ProfileInfo> {\n    return this.waitForTarget.then(target => target.getProfileInfo());\n  }\n\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    const identity = await this.waitForTarget.then(target =>\n      target.getBackstageIdentity(),\n    );\n    if (!identity.userEntityRef.match(/^.*:.*\\/.*$/)) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `WARNING: The App IdentityApi provided an invalid userEntityRef, '${identity.userEntityRef}'. ` +\n          `It must be a full Entity Reference of the form '<kind>:<namespace>/<name>'.`,\n      );\n    }\n\n    return identity;\n  }\n\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    return this.waitForTarget.then(target => target.getCredentials());\n  }\n\n  async getIdToken(): Promise<string | undefined> {\n    return this.waitForTarget.then(target => {\n      if (!target.getIdToken) {\n        throw new Error('IdentityApi does not implement getIdToken');\n      }\n      logDeprecation('getIdToken');\n      return target.getIdToken();\n    });\n  }\n\n  async signOut(): Promise<void> {\n    await this.waitForTarget.then(target => target.signOut());\n    location.reload();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo, useEffect, useState, PropsWithChildren } from 'react';\nimport { useApi, appThemeApiRef, AppTheme } from '@backstage/core-plugin-api';\nimport useObservable from 'react-use/lib/useObservable';\n\n// This tries to find the most accurate match, but also falls back to less\n// accurate results in order to avoid errors.\nfunction resolveTheme(\n  themeId: string | undefined,\n  shouldPreferDark: boolean,\n  themes: AppTheme[],\n) {\n  if (themeId !== undefined) {\n    const selectedTheme = themes.find(theme => theme.id === themeId);\n    if (selectedTheme) {\n      return selectedTheme;\n    }\n  }\n\n  if (shouldPreferDark) {\n    const darkTheme = themes.find(theme => theme.variant === 'dark');\n    if (darkTheme) {\n      return darkTheme;\n    }\n  }\n\n  const lightTheme = themes.find(theme => theme.variant === 'light');\n  if (lightTheme) {\n    return lightTheme;\n  }\n\n  return themes[0];\n}\n\nconst useShouldPreferDarkTheme = () => {\n  const mediaQuery = useMemo(\n    () => window.matchMedia('(prefers-color-scheme: dark)'),\n    [],\n  );\n  const [shouldPreferDark, setPrefersDark] = useState(mediaQuery.matches);\n\n  useEffect(() => {\n    const listener = (event: MediaQueryListEvent) => {\n      setPrefersDark(event.matches);\n    };\n    mediaQuery.addListener(listener);\n    return () => {\n      mediaQuery.removeListener(listener);\n    };\n  }, [mediaQuery]);\n\n  return shouldPreferDark;\n};\n\nexport function AppThemeProvider({ children }: PropsWithChildren<{}>) {\n  const appThemeApi = useApi(appThemeApiRef);\n  const themeId = useObservable(\n    appThemeApi.activeThemeId$(),\n    appThemeApi.getActiveThemeId(),\n  );\n\n  // Browser feature detection won't change over time, so ignore lint rule\n  const shouldPreferDark = Boolean(window.matchMedia)\n    ? useShouldPreferDarkTheme() // eslint-disable-line react-hooks/rules-of-hooks\n    : false;\n\n  const appTheme = resolveTheme(\n    themeId,\n    shouldPreferDark,\n    appThemeApi.getInstalledThemes(),\n  );\n  if (!appTheme) {\n    throw new Error('App has no themes');\n  }\n\n  return <appTheme.Provider children={children} />;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppConfig } from '@backstage/config';\nimport { JsonObject } from '@backstage/types';\nimport { AppConfigLoader } from './types';\n\n/**\n * The default config loader, which expects that config is available at compile-time\n * in `process.env.APP_CONFIG`. APP_CONFIG should be an array of config objects as\n * returned by the config loader.\n *\n * It will also load runtime config from the __APP_INJECTED_RUNTIME_CONFIG__ string,\n * which can be rewritten at runtime to contain an additional JSON config object.\n * If runtime config is present, it will be placed first in the config array, overriding\n * other config values.\n *\n * @public\n */\nexport const defaultConfigLoader: AppConfigLoader = async (\n  // This string may be replaced at runtime to provide additional config.\n  // It should be replaced by a JSON-serialized config object.\n  // It's a param so we can test it, but at runtime this will always fall back to default.\n  runtimeConfigJson: string = '__APP_INJECTED_RUNTIME_CONFIG__',\n) => {\n  const appConfig = process.env.APP_CONFIG;\n  if (!appConfig) {\n    throw new Error('No static configuration provided');\n  }\n  if (!Array.isArray(appConfig)) {\n    throw new Error('Static configuration has invalid format');\n  }\n  const configs = appConfig.slice() as unknown as AppConfig[];\n\n  // Avoiding this string also being replaced at runtime\n  if (\n    runtimeConfigJson !==\n    '__app_injected_runtime_config__'.toLocaleUpperCase('en-US')\n  ) {\n    try {\n      const data = JSON.parse(runtimeConfigJson) as JsonObject;\n      if (Array.isArray(data)) {\n        configs.push(...data);\n      } else {\n        configs.push({ data, context: 'env' });\n      }\n    } catch (error) {\n      throw new Error(`Failed to load runtime configuration, ${error}`);\n    }\n  }\n\n  const windowAppConfig = (window as any).__APP_CONFIG__;\n  if (windowAppConfig) {\n    configs.push({\n      context: 'window',\n      data: windowAppConfig,\n    });\n  }\n  return configs;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\ntype ApiImpl<T = unknown> = readonly [ApiRef<T>, T];\n\n/** @internal */\nclass ApiRegistryBuilder {\n  private apis: [string, unknown][] = [];\n\n  add<T, I extends T>(api: ApiRef<T>, impl: I): I {\n    this.apis.push([api.id, impl]);\n    return impl;\n  }\n\n  build(): ApiRegistry {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return new ApiRegistry(new Map(this.apis));\n  }\n}\n\n/**\n * A registry for utility APIs.\n *\n * @internal\n */\nexport class ApiRegistry implements ApiHolder {\n  static builder() {\n    return new ApiRegistryBuilder();\n  }\n\n  /**\n   * Creates a new ApiRegistry with a list of API implementations.\n   *\n   * @param apis - A list of pairs mapping an ApiRef to its respective implementation\n   */\n  static from(apis: ApiImpl[]) {\n    return new ApiRegistry(new Map(apis.map(([api, impl]) => [api.id, impl])));\n  }\n\n  /**\n   * Creates a new ApiRegistry with a single API implementation.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  static with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([[api.id, impl]]));\n  }\n\n  constructor(private readonly apis: Map<string, unknown>) {}\n\n  /**\n   * Returns a new ApiRegistry with the provided API added to the existing ones.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([...this.apis, [api.id, impl]]));\n  }\n\n  get<T>(api: ApiRef<T>): T | undefined {\n    return this.apis.get(api.id) as T | undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n} from '@backstage/core-plugin-api';\nimport { AppOptions, AppRouteBinder } from './types';\n\nexport function resolveRouteBindings(bindRoutes: AppOptions['bindRoutes']) {\n  const result = new Map<ExternalRouteRef, RouteRef | SubRouteRef>();\n\n  if (bindRoutes) {\n    const bind: AppRouteBinder = (\n      externalRoutes,\n      targetRoutes: { [name: string]: RouteRef | SubRouteRef },\n    ) => {\n      for (const [key, value] of Object.entries(targetRoutes)) {\n        const externalRoute = externalRoutes[key];\n        if (!externalRoute) {\n          throw new Error(`Key ${key} is not an existing external route`);\n        }\n        if (!value && !externalRoute.optional) {\n          throw new Error(\n            `External route ${key} is required but was undefined`,\n          );\n        }\n        if (value) {\n          result.set(externalRoute, value);\n        }\n      }\n    };\n    bindRoutes({ bind });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport React, {\n  ComponentType,\n  PropsWithChildren,\n  ReactElement,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport { Route, Routes } from 'react-router-dom';\nimport useAsync from 'react-use/lib/useAsync';\nimport {\n  ApiProvider,\n  AppThemeSelector,\n  ConfigReader,\n  LocalStorageFeatureFlags,\n} from '../apis';\nimport {\n  useApi,\n  AnyApiFactory,\n  ApiHolder,\n  IconComponent,\n  AppTheme,\n  appThemeApiRef,\n  configApiRef,\n  AppThemeApi,\n  ConfigApi,\n  featureFlagsApiRef,\n  IdentityApi,\n  identityApiRef,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryRegistry, ApiResolver } from '../apis/system';\nimport {\n  childDiscoverer,\n  routeElementDiscoverer,\n  traverseElementTree,\n} from '../extensions/traversal';\nimport { pluginCollector } from '../plugins/collectors';\nimport {\n  featureFlagCollector,\n  routeObjectCollector,\n  routeParentCollector,\n  routePathCollector,\n} from '../routing/collectors';\nimport { RoutingProvider } from '../routing/RoutingProvider';\nimport { RouteTracker } from '../routing/RouteTracker';\nimport {\n  validateRouteParameters,\n  validateRouteBindings,\n} from '../routing/validation';\nimport { AppContextProvider } from './AppContext';\nimport { AppIdentityProxy } from '../apis/implementations/IdentityApi/AppIdentityProxy';\nimport {\n  AppComponents,\n  AppConfigLoader,\n  AppContext,\n  AppOptions,\n  BackstageApp,\n  SignInPageProps,\n} from './types';\nimport { AppThemeProvider } from './AppThemeProvider';\nimport { defaultConfigLoader } from './defaultConfigLoader';\nimport { ApiRegistry } from '../apis/system/ApiRegistry';\nimport { resolveRouteBindings } from './resolveRouteBindings';\n\ntype CompatiblePlugin =\n  | BackstagePlugin<any, any>\n  | (Omit<BackstagePlugin<any, any>, 'getFeatureFlags'> & {\n      output(): Array<{ type: 'feature-flag'; name: string }>;\n    });\n\n/**\n * Get the app base path from the configured app baseUrl.\n *\n * The returned path does not have a trailing slash.\n */\nfunction getBasePath(configApi: Config) {\n  let { pathname } = new URL(\n    configApi.getOptionalString('app.baseUrl') ?? '/',\n    'http://dummy.dev', // baseUrl can be specified as just a path\n  );\n  pathname = pathname.replace(/\\/*$/, '');\n  return pathname;\n}\n\nfunction useConfigLoader(\n  configLoader: AppConfigLoader | undefined,\n  components: AppComponents,\n  appThemeApi: AppThemeApi,\n): { api: ConfigApi } | { node: JSX.Element } {\n  // Keeping this synchronous when a config loader isn't set simplifies tests a lot\n  const hasConfig = Boolean(configLoader);\n  const config = useAsync(configLoader || (() => Promise.resolve([])));\n\n  let noConfigNode = undefined;\n\n  if (hasConfig && config.loading) {\n    const { Progress } = components;\n    noConfigNode = <Progress />;\n  } else if (config.error) {\n    const { BootErrorPage } = components;\n    noConfigNode = <BootErrorPage step=\"load-config\" error={config.error} />;\n  }\n\n  const { ThemeProvider = AppThemeProvider } = components;\n\n  // Before the config is loaded we can't use a router, so exit early\n  if (noConfigNode) {\n    return {\n      node: (\n        <ApiProvider apis={ApiRegistry.with(appThemeApiRef, appThemeApi)}>\n          <ThemeProvider>{noConfigNode}</ThemeProvider>\n        </ApiProvider>\n      ),\n    };\n  }\n\n  const configReader = ConfigReader.fromConfigs(config.value ?? []);\n\n  return { api: configReader };\n}\n\nclass AppContextImpl implements AppContext {\n  constructor(private readonly app: AppManager) {}\n\n  getPlugins(): BackstagePlugin<any, any>[] {\n    return this.app.getPlugins();\n  }\n\n  getSystemIcon(key: string): IconComponent | undefined {\n    return this.app.getSystemIcon(key);\n  }\n\n  getComponents(): AppComponents {\n    return this.app.getComponents();\n  }\n}\n\nexport class AppManager implements BackstageApp {\n  private apiHolder?: ApiHolder;\n  private configApi?: ConfigApi;\n\n  private readonly apis: Iterable<AnyApiFactory>;\n  private readonly icons: NonNullable<AppOptions['icons']>;\n  private readonly plugins: Set<CompatiblePlugin>;\n  private readonly components: AppComponents;\n  private readonly themes: AppTheme[];\n  private readonly configLoader?: AppConfigLoader;\n  private readonly defaultApis: Iterable<AnyApiFactory>;\n  private readonly bindRoutes: AppOptions['bindRoutes'];\n\n  private readonly appIdentityProxy = new AppIdentityProxy();\n  private readonly apiFactoryRegistry: ApiFactoryRegistry;\n\n  constructor(options: AppOptions) {\n    this.apis = options.apis ?? [];\n    this.icons = options.icons;\n    this.plugins = new Set((options.plugins as CompatiblePlugin[]) ?? []);\n    this.components = options.components;\n    this.themes = options.themes as AppTheme[];\n    this.configLoader = options.configLoader ?? defaultConfigLoader;\n    this.defaultApis = options.defaultApis ?? [];\n    this.bindRoutes = options.bindRoutes;\n    this.apiFactoryRegistry = new ApiFactoryRegistry();\n  }\n\n  getPlugins(): BackstagePlugin<any, any>[] {\n    return Array.from(this.plugins) as BackstagePlugin<any, any>[];\n  }\n\n  getSystemIcon(key: string): IconComponent | undefined {\n    return this.icons[key];\n  }\n\n  getComponents(): AppComponents {\n    return this.components;\n  }\n\n  getProvider(): ComponentType<{}> {\n    const appContext = new AppContextImpl(this);\n\n    // We only validate routes once\n    let routesHaveBeenValidated = false;\n\n    const Provider = ({ children }: PropsWithChildren<{}>) => {\n      const appThemeApi = useMemo(\n        () => AppThemeSelector.createWithStorage(this.themes),\n        [],\n      );\n\n      const {\n        routePaths,\n        routeParents,\n        routeObjects,\n        featureFlags,\n        routeBindings,\n      } = useMemo(() => {\n        const result = traverseElementTree({\n          root: children,\n          discoverers: [childDiscoverer, routeElementDiscoverer],\n          collectors: {\n            routePaths: routePathCollector,\n            routeParents: routeParentCollector,\n            routeObjects: routeObjectCollector,\n            collectedPlugins: pluginCollector,\n            featureFlags: featureFlagCollector,\n          },\n        });\n\n        // TODO(Rugvip): Restructure the public API so that we can get an immediate view of\n        //               the app, rather than having to wait for the provider to render.\n        //               For now we need to push the additional plugins we find during\n        //               collection and then make sure we initialize things afterwards.\n        result.collectedPlugins.forEach(plugin => this.plugins.add(plugin));\n        this.verifyPlugins(this.plugins);\n\n        // Initialize APIs once all plugins are available\n        this.getApiHolder();\n        return {\n          ...result,\n          routeBindings: resolveRouteBindings(this.bindRoutes),\n        };\n      }, [children]);\n\n      if (!routesHaveBeenValidated) {\n        routesHaveBeenValidated = true;\n        validateRouteParameters(routePaths, routeParents);\n        validateRouteBindings(\n          routeBindings,\n          this.plugins as Iterable<BackstagePlugin<any, any>>,\n        );\n      }\n\n      const loadedConfig = useConfigLoader(\n        this.configLoader,\n        this.components,\n        appThemeApi,\n      );\n\n      const hasConfigApi = 'api' in loadedConfig;\n      if (hasConfigApi) {\n        const { api } = loadedConfig as { api: Config };\n        this.configApi = api;\n      }\n\n      useEffect(() => {\n        if (hasConfigApi) {\n          const featureFlagsApi = this.getApiHolder().get(featureFlagsApiRef)!;\n\n          for (const plugin of this.plugins.values()) {\n            if ('getFeatureFlags' in plugin) {\n              for (const flag of plugin.getFeatureFlags()) {\n                featureFlagsApi.registerFlag({\n                  name: flag.name,\n                  pluginId: plugin.getId(),\n                });\n              }\n            } else {\n              for (const output of plugin.output()) {\n                if (output.type === 'feature-flag') {\n                  featureFlagsApi.registerFlag({\n                    name: output.name,\n                    pluginId: plugin.getId(),\n                  });\n                }\n              }\n            }\n          }\n\n          // Go through the featureFlags returned from the traversal and\n          // register those now the configApi has been loaded\n          for (const name of featureFlags) {\n            featureFlagsApi.registerFlag({ name, pluginId: '' });\n          }\n        }\n      }, [hasConfigApi, loadedConfig, featureFlags]);\n\n      if ('node' in loadedConfig) {\n        // Loading or error\n        return loadedConfig.node;\n      }\n\n      const { ThemeProvider = AppThemeProvider } = this.components;\n\n      return (\n        <ApiProvider apis={this.getApiHolder()}>\n          <AppContextProvider appContext={appContext}>\n            <ThemeProvider>\n              <RoutingProvider\n                routePaths={routePaths}\n                routeParents={routeParents}\n                routeObjects={routeObjects}\n                routeBindings={routeBindings}\n                basePath={getBasePath(loadedConfig.api)}\n              >\n                {children}\n              </RoutingProvider>\n            </ThemeProvider>\n          </AppContextProvider>\n        </ApiProvider>\n      );\n    };\n    return Provider;\n  }\n\n  getRouter(): ComponentType<{}> {\n    const { Router: RouterComponent, SignInPage: SignInPageComponent } =\n      this.components;\n\n    // This wraps the sign-in page and waits for sign-in to be completed before rendering the app\n    const SignInPageWrapper = ({\n      component: Component,\n      children,\n    }: {\n      component: ComponentType<SignInPageProps>;\n      children: ReactElement;\n    }) => {\n      const [identityApi, setIdentityApi] = useState<IdentityApi>();\n\n      if (!identityApi) {\n        return <Component onSignInSuccess={setIdentityApi} />;\n      }\n\n      this.appIdentityProxy.setTarget(identityApi);\n      return children;\n    };\n\n    const AppRouter = ({ children }: PropsWithChildren<{}>) => {\n      const configApi = useApi(configApiRef);\n      const mountPath = `${getBasePath(configApi)}/*`;\n\n      // If the app hasn't configured a sign-in page, we just continue as guest.\n      if (!SignInPageComponent) {\n        this.appIdentityProxy.setTarget({\n          getUserId: () => 'guest',\n          getIdToken: async () => undefined,\n          getProfile: () => ({\n            email: 'guest@example.com',\n            displayName: 'Guest',\n          }),\n          getProfileInfo: async () => ({\n            email: 'guest@example.com',\n            displayName: 'Guest',\n          }),\n          getBackstageIdentity: async () => ({\n            type: 'user',\n            userEntityRef: 'user:default/guest',\n            ownershipEntityRefs: ['user:default/guest'],\n          }),\n          getCredentials: async () => ({}),\n          signOut: async () => {},\n        });\n\n        return (\n          <RouterComponent>\n            <RouteTracker tree={children} />\n            <Routes>\n              <Route path={mountPath} element={<>{children}</>} />\n            </Routes>\n          </RouterComponent>\n        );\n      }\n\n      return (\n        <RouterComponent>\n          <RouteTracker tree={children} />\n          <SignInPageWrapper component={SignInPageComponent}>\n            <Routes>\n              <Route path={mountPath} element={<>{children}</>} />\n            </Routes>\n          </SignInPageWrapper>\n        </RouterComponent>\n      );\n    };\n\n    return AppRouter;\n  }\n\n  private getApiHolder(): ApiHolder {\n    if (this.apiHolder) {\n      // Register additional plugins if they have been added.\n      // Routes paths, objects and others are already updated in the provider when children of it change\n      for (const plugin of this.plugins) {\n        for (const factory of plugin.getApis()) {\n          if (!this.apiFactoryRegistry.get(factory.api)) {\n            this.apiFactoryRegistry.register('default', factory);\n          }\n        }\n      }\n      ApiResolver.validateFactories(\n        this.apiFactoryRegistry,\n        this.apiFactoryRegistry.getAllApis(),\n      );\n      return this.apiHolder;\n    }\n    this.apiFactoryRegistry.register('static', {\n      api: appThemeApiRef,\n      deps: {},\n      factory: () => AppThemeSelector.createWithStorage(this.themes),\n    });\n    this.apiFactoryRegistry.register('static', {\n      api: configApiRef,\n      deps: {},\n      factory: () => {\n        if (!this.configApi) {\n          throw new Error(\n            'Tried to access config API before config was loaded',\n          );\n        }\n        return this.configApi;\n      },\n    });\n    this.apiFactoryRegistry.register('static', {\n      api: identityApiRef,\n      deps: {},\n      factory: () => this.appIdentityProxy,\n    });\n\n    // It's possible to replace the feature flag API, but since we must have at least\n    // one implementation we add it here directly instead of through the defaultApis.\n    this.apiFactoryRegistry.register('default', {\n      api: featureFlagsApiRef,\n      deps: {},\n      factory: () => new LocalStorageFeatureFlags(),\n    });\n    for (const factory of this.defaultApis) {\n      this.apiFactoryRegistry.register('default', factory);\n    }\n\n    for (const plugin of this.plugins) {\n      for (const factory of plugin.getApis()) {\n        if (!this.apiFactoryRegistry.register('default', factory)) {\n          throw new Error(\n            `Plugin ${plugin.getId()} tried to register duplicate or forbidden API factory for ${\n              factory.api\n            }`,\n          );\n        }\n      }\n    }\n\n    for (const factory of this.apis) {\n      if (!this.apiFactoryRegistry.register('app', factory)) {\n        throw new Error(\n          `Duplicate or forbidden API factory for ${factory.api} in app`,\n        );\n      }\n    }\n\n    ApiResolver.validateFactories(\n      this.apiFactoryRegistry,\n      this.apiFactoryRegistry.getAllApis(),\n    );\n\n    this.apiHolder = new ApiResolver(this.apiFactoryRegistry);\n    return this.apiHolder;\n  }\n\n  private verifyPlugins(plugins: Iterable<CompatiblePlugin>) {\n    const pluginIds = new Set<string>();\n\n    for (const plugin of plugins) {\n      const id = plugin.getId();\n      if (pluginIds.has(id)) {\n        throw new Error(`Duplicate plugin found '${id}'`);\n      }\n      pluginIds.add(id);\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppManager } from './AppManager';\nimport { AppOptions, BackstageApp } from './types';\n\n/**\n * Creates a new Backstage App where the full set of options are required.\n *\n * @public\n * @param options - A set of options for creating the app\n * @returns\n * @remarks\n *\n * You will most likely want to use {@link @backstage/app-defaults#createApp},\n * however, this low-level API allows you to provide a full set of options,\n * including your own `components`, `icons`, `defaultApis`, and `themes`. This\n * is particularly useful if you are not using `@backstage/core-components` or\n * MUI, as it allows you to avoid those dependencies completely.\n */\nexport function createSpecializedApp(options: AppOptions): BackstageApp {\n  return new AppManager(options);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport { useRoutes } from 'react-router-dom';\nimport { useApp, useElementFilter } from '@backstage/core-plugin-api';\n\ntype RouteObject = {\n  path: string;\n  element: ReactNode;\n  children?: RouteObject[];\n};\n\n/**\n * Props for the {@link FlatRoutes} component.\n *\n * @public\n */\nexport type FlatRoutesProps = {\n  children: ReactNode;\n};\n\n/**\n * A wrapper around a set of routes.\n *\n * @remarks\n *\n * The root of the routing hierarchy in your app should use this component,\n * instead of the one from `react-router-dom`. This ensures that all of the\n * plugin route and utility API wiring happens under the hood.\n *\n * @public\n */\nexport const FlatRoutes = (props: FlatRoutesProps): JSX.Element | null => {\n  const app = useApp();\n  const { NotFoundErrorPage } = app.getComponents();\n  const routes = useElementFilter(props.children, elements =>\n    elements\n      .getElements<{ path?: string; children: ReactNode }>()\n      .flatMap<RouteObject>(child => {\n        let path = child.props.path;\n\n        // TODO(Rugvip): Work around plugins registering empty paths, remove once deprecated routes are gone\n        if (path === '') {\n          return [];\n        }\n        path = path?.replace(/\\/\\*$/, '') ?? '/';\n\n        return [\n          {\n            path,\n            element: child,\n            children: child.props.children\n              ? [\n                  // These are the children of each route, which we all add in under a catch-all\n                  // subroute in order to make them available to `useOutlet`\n                  {\n                    path: path === '/' ? '/' : '/*', // The root path must require an exact match\n                    element: child.props.children,\n                  },\n                ]\n              : undefined,\n          },\n        ];\n      })\n      // Routes are sorted to work around a bug where prefixes are unexpectedly matched\n      .sort((a, b) => b.path.localeCompare(a.path))\n      // We make sure all routes have '/*' appended, except '/'\n      .map(obj => {\n        obj.path = obj.path === '/' ? '/' : `${obj.path}/*`;\n        return obj;\n      }),\n  );\n\n  // TODO(Rugvip): Possibly add a way to skip this, like a noNotFoundPage prop\n  routes.push({\n    element: <NotFoundErrorPage />,\n    path: '/*',\n  });\n\n  return useRoutes(routes);\n};\n"],"names":["hasScopes","DEFAULT_PROVIDER","SCOPE_PREFIX"],"mappings":"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"}