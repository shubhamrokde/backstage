import { useCallback } from 'react';
import { resolveHookState } from "../util/resolveHookState.js";
import { useSafeState, useSyncedRef } from '..';
/**
 * Like `useState`, but every value set is passed through a mediator function.
 */
export function useMediatedState(initialState, mediator) {
    const [state, setState] = useSafeState(initialState);
    const mediatorRef = useSyncedRef(mediator);
    return [
        state,
        useCallback((value) => {
            if (mediatorRef.current) {
                setState((prevState) => mediatorRef.current?.(resolveHookState(value, prevState)));
            }
            else {
                setState(value);
            }
            // eslint-disable-next-line react-hooks/exhaustive-deps
        }, []),
    ];
}
